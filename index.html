<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gestión de Órdenes</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
/* Estilos existentes sin cambios */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Inter', sans-serif;
}

:root {
/* Colores adaptados del ejemplo */
--primary: #2563eb;
--primary-dark: #1d4ed8;
--secondary: #f97316;
--secondary-dark: #ea580c;
--danger: #ef4444;
--warning: #f59e0b;
--success: #10b981;
--gray-50: #f9fafb;
--gray-100: #f3f4f6;
--gray-200: #e5e7eb;
--gray-300: #d1d5db;
--gray-400: #9ca3af;
--gray-500: #6b7280;
--gray-600: #4b5563;
--gray-700: #374151;
--gray-800: #1f2937;
--gray-900: #111827;
--v-theme-surface: 255, 255, 255;
--header-bg: #1a3a5f;
--header-text: #ffffff;
--sidebar-bg: #f8fafc;
--sidebar-border: #e2e8f0;
--card-bg: #ffffff;
--card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
--table-header-bg: #f8fafc;
--table-border: #e2e8f0;
--btn-hover: #f1f5f9;
--sidebar-width: 300px;
--backlog-color: #8b5cf6; /* Color específico para la bandeja backlog */
--tcp-color: #3b82f6; /* Color específico para la bandeja TCP */
--cierre-color: #10b981; /* Color específico para la bandeja cierre */
--finalizado-color: #6366f1; /* Color específico para la bandeja finalizado */
}

body {
background-color: var(--gray-50);
color: var(--gray-900);
line-height: 1.6;
display: flex;
min-height: 100vh;
}

/* Sidebar Styles */
.sidebar {
width: var(--sidebar-width);
background-color: rgb(47, 51, 73);
color: var(--header-text);
padding: 20px 0;
display: flex;
flex-direction: column;
position: fixed;
height: 100vh;
overflow-y: auto;
box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
z-index: 1000;
}

.sidebar-header {
padding: 0 20px 30px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
margin-bottom: 20px;
}

.sidebar-title {
font-size: 20px;
font-weight: 700;
display: flex;
align-items: center;
gap: 10px;
}

.sidebar-menu {
flex: 1;
}

/* Estilos para módulos del menú */
.menu-module {
  margin-bottom: 8px;
}

.module-title {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border-left: 3px solid transparent;
}

.module-title:hover {
  background-color: rgba(255, 255, 255, 0.1);
  color: white;
}

.module-title i:first-child {
  width: 24px;
  margin-right: 12px;
  text-align: center;
  font-size: 18px;
}

.module-title span {
  flex: 1;
}

.module-arrow {
  font-size: 12px;
  transition: transform 0.3s;
}

.module-arrow.rotated {
  transform: rotate(180deg);
}

.module-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out;
  background-color: rgba(0, 0, 0, 0.1);
}

.module-content.expanded {
  max-height: 500px; /* Ajustar según la cantidad de elementos */
}

.module-content .menu-item {
  padding-left: 40px; /* Espacio adicional para submenús */
  font-size: 14px;
}

.module-content .menu-item i {
  width: 20px;
  margin-right: 12px;
  font-size: 16px;
}

.menu-item,.profile {
display: block;
padding: 14px 20px;
color: rgba(255, 255, 255, 0.8);
text-decoration: none;
transition: all 0.2s;
font-weight: 500;
border-left: 3px solid transparent;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

.menu-item:hover,.profile:hover {
background-color: rgba(255, 255, 255, 0.1);
color: white;
}

.menu-item.active, .profile.active {
background-color: rgba(255, 255, 255, 0.15);
color: white;
}

.menu-item.active.tcp {
border-left-color: var(--tcp-color);
}

.menu-item.active.backlog {
border-left-color: var(--backlog-color);
}

.menu-item.active.cierre {
border-left-color: var(--cierre-color);
}

.menu-item.active.finalizado {
border-left-color: var(--finalizado-color);
}

.menu-item i, .profile i {
width: 24px;
margin-right: 15px;
text-align: center;
font-size: 18px;
}

.sidebar-footer {
padding: 20px;
border-top: 1px solid rgba(255, 255, 255, 0.1);
font-size: 12px;
color: rgba(255, 255, 255, 0.6);
text-align: center;
}

/* Main Content */
.main-container {
flex: 1;
margin-left: var(--sidebar-width);
padding: 20px;
display: flex;
flex-direction: column;
}

.container {
max-width: 1400px;
margin: 0 auto;
width: 100%;
}

header {
background-color: rgb(var(--v-theme-surface));
border-radius: 12px;
padding: 24px;
box-shadow: var(--card-shadow);
margin-bottom: 24px;
color: var(--header-text);
}

.header-top {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.header-title {
font-size: 28px;
font-weight: 700;
color: var(--header-text);
}

.user-info {
display: flex;
align-items: center;
gap: 12px;
}

.user-avatar {
width: 40px;
height: 40px;
border-radius: 50%;
background-color: var(--primary);
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
}

.alert-banner {
background-color: #fef3c7;
border-left: 4px solid var(--warning);
padding: 16px;
border-radius: 8px;
display: flex;
align-items: center;
gap: 12px;
margin-bottom: 20px;
}

.alert-banner i {
color: var(--warning);
font-size: 20px;
}

.alert-text {
font-weight: 500;
color: var(--gray-800);
}

.alert-banner button {
background-color: var(--warning);
color: white;
border: none;
padding: 6px 12px;
border-radius: 6px;
font-weight: 500;
cursor: pointer;
margin-left: auto;
transition: background-color 0.2s;
}

.alert-banner button:hover {
background-color: #d97706;
}

.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 16px;
}

.stat-card {
background-color: var(--card-bg);
border-radius: 8px;
padding: 16px;
box-shadow: var(--card-shadow);
display: flex;
align-items: center;
gap: 12px;
border: 1px solid var(--sidebar-border);
}

.stat-icon {
width: 48px;
height: 48px;
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
}

.stat-icon.total {
background-color: rgba(37, 99, 235, 0.1);
color: var(--primary);
}

.stat-icon.critical {
background-color: rgba(239, 68, 68, 0.1);
color: var(--danger);
}

.stat-icon.processing {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.stat-icon.completed {
background-color: rgba(99, 102, 241, 0.1);
color: var(--finalizado-color);
}

.stat-content h3 {
font-size: 24px;
font-weight: 700;
margin-bottom: 4px;
color: var(--gray-900);
}

.stat-content p {
color: var(--gray-500);
font-size: 14px;
}

.main-content {
background-color: var(--card-bg);
border-radius: 12px;
box-shadow: var(--card-shadow);
overflow: hidden;
border: 1px solid var(--sidebar-border);
}

.table-header {
background-color: var(--table-header-bg);
padding: 20px 24px;
border-bottom: 1px solid var(--table-border);
display: flex;
justify-content: space-between;
align-items: center;
}

.table-title {
font-size: 18px;
font-weight: 600;
color: var(--gray-900);
}

.filter-actions {
display: flex;
gap: 12px;
}

.filter-btn {
background-color: var(--card-bg);
border: 1px solid var(--sidebar-border);
border-radius: 6px;
padding: 8px 12px;
display: flex;
align-items: center;
gap: 6px;
cursor: pointer;
font-size: 14px;
color: var(--gray-700);
transition: all 0.2s;
}

.filter-btn:hover {
background-color: var(--btn-hover);
}

.filter-btn.active {
background-color: var(--primary);
color: white;
border-color: var(--primary);
}

.orders-table {
width: 100%;
border-collapse: collapse;
}

.orders-table th {
text-align: left;
padding: 12px 24px;
font-weight: 600;
color: var(--gray-600);
font-size: 14px;
background-color: var(--table-header-bg);
border-bottom: 1px solid var(--table-border);
}

.orders-table td {
padding: 16px 24px;
border-bottom: 1px solid var(--table-border);
}

.orders-table tr:hover {
background-color: var(--btn-hover);
}

.order-id {
font-weight: 600;
color: var(--primary);
}

.status-badge {
display: inline-block;
padding: 4px 8px;
border-radius: 4px;
font-size: 12px;
font-weight: 500;
}

.status-no-contact {
background-color: rgba(239, 68, 68, 0.1);
color: var(--danger);
}

.status-rescheduled {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

.status-waiting-info {
background-color: rgba(139, 92, 246, 0.1);
color: var(--backlog-color);
}

.status-derivated {
background-color: rgba(37, 99, 235, 0.1);
color: var(--primary);
}

.status-pending {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

.status-processing {
background-color: rgba(37, 99, 235, 0.1);
color: var(--primary);
}

.status-completed {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.status-in-progress {
background-color: rgba(37, 99, 235, 0.1);
color: var(--primary);
}

.status-failed {
background-color: rgba(239, 68, 68, 0.1);
color: var(--danger);
}

.status-validated {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.priority-badge {
display: inline-block;
padding: 4px 8px;
border-radius: 4px;
font-size: 12px;
font-weight: 500;
}

.priority-high {
background-color: rgba(239, 68, 68, 0.1);
color: var(--danger);
}

.priority-medium {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

.priority-low {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.attempts-badge {
display: inline-block;
padding: 4px 8px;
border-radius: 4px;
font-size: 12px;
font-weight: 500;
background-color: rgba(107, 114, 128, 0.1);
color: var(--gray-600);
}

.actions {
display: flex;
justify-content: center;
gap: 6px;
}

.action-btn {
width: 32px;
height: 32px;
border-radius: 6px;
border: none;
background-color: var(--gray-100);
color: var(--gray-600);
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s;
}

.action-btn:hover {
background-color: var(--gray-200);
}

.action-btn.primary {
background-color: var(--primary);
color: white;
}

.action-btn.primary:hover {
background-color: var(--primary-dark);
}

.action-btn.backlog {
background-color: var(--backlog-color);
color: white;
}

.action-btn.backlog:hover {
background-color: #7c3aed;
}

.action-btn.cierre {
background-color: var(--cierre-color);
color: white;
}

.action-btn.cierre:hover {
background-color: #059669;
}

.action-btn.finalizado {
background-color: var(--finalizado-color);
color: white;
}

.action-btn.finalizado:hover {
background-color: #4f46e5;
}

/* Alerta de vencimiento */
.expiration-alert {
background-color: rgba(239, 68, 68, 0.1);
border-left: 4px solid var(--danger);
padding: 12px 16px;
border-radius: 6px;
margin-bottom: 16px;
display: flex;
align-items: center;
gap: 12px;
}

.expiration-alert i {
color: var(--danger);
font-size: 18px;
}

.expiration-text {
font-size: 14px;
color: var(--gray-800);
}

.expiration-text strong {
color: var(--danger);
}

/* Modal Detalle de Orden */
.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.5);
align-items: center;
justify-content: center;
}

.modal-content {
background-color: var(--card-bg);
border-radius: 12px;
width: 90%;
max-width: 800px;
max-height: 80vh;
overflow-y: auto;
box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
border: 1px solid var(--sidebar-border);
}

.modal-header {
padding: 20px 30px;
border-bottom: 1px solid var(--table-border);
display: flex;
justify-content: space-between;
align-items: center;
background-color: var(--table-header-bg);
}

.modal-title {
font-size: 20px;
font-weight: 600;
color: var(--gray-900);
}

.close-btn {
background: none;
border: none;
font-size: 24px;
color: var(--gray-500);
cursor: pointer;
}

.modal-body {
padding: 30px;
}

.form-group {
margin-bottom: 20px;
}

.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 500;
color: var(--gray-700);
}

.form-control {
width: 100%;
padding: 10px 14px;
border: 1px solid var(--sidebar-border);
border-radius: 6px;
font-size: 14px;
transition: border-color 0.2s;
background-color: var(--card-bg);
}

.form-control:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-actions {
display: flex;
justify-content: flex-end;
gap: 12px;
margin-top: 24px;
}

.btn {
padding: 10px 16px;
border-radius: 6px;
font-weight: 500;
cursor: pointer;
border: none;
font-size: 14px;
transition: all 0.2s;
}

.btn-primary {
background-color: var(--primary);
color: white;
}

.btn-primary:hover {
background-color: var(--primary-dark);
}

.btn-secondary {
background-color: var(--card-bg);
color: var(--gray-700);
border: 1px solid var(--sidebar-border);
}

.btn-secondary:hover {
background-color: var(--btn-hover);
}

.detail-tabs {
display: flex;
border-bottom: 1px solid var(--table-border);
margin-bottom: 20px;
}

.detail-tab {
padding: 16px 24px;
cursor: pointer;
font-weight: 500;
color: var(--gray-500);
border-bottom: 2px solid transparent;
transition: all 0.2s;
white-space: nowrap;
}

.detail-tab.active {
color: var(--primary);
border-bottom-color: var(--primary);
}

.detail-content {
display: none;
}

.detail-content.active {
display: block;
}

.detail-row {
display: flex;
margin-bottom: 16px;
}

.detail-label {
width: 150px;
font-weight: 500;
color: var(--gray-600);
}

.detail-value {
flex: 1;
color: var(--gray-800);
}

.timeline {
position: relative;
padding-left: 30px;
}

.timeline::before {
content: '';
position: absolute;
left: 8px;
top: 0;
height: 100%;
width: 2px;
background-color: var(--sidebar-border);
}

.timeline-item {
position: relative;
margin-bottom: 20px;
}

.timeline-item::before {
content: '';
position: absolute;
left: -30px;
top: 6px;
width: 16px;
height: 16px;
border-radius: 50%;
background-color: white;
border: 2px solid var(--primary);
}

.timeline-date {
font-size: 12px;
color: var(--gray-500);
margin-bottom: 4px;
}

.timeline-area {
font-size: 12px;
color: var(--primary);
margin-bottom: 2px;
font-weight: 500;
}

.timeline-user {
font-size: 12px;
color: var(--gray-600);
margin-bottom: 4px;
}

.timeline-content {
background-color: var(--btn-hover);
padding: 12px;
border-radius: 6px;
}

/* Sección de acciones de backlog */
.contact-section {
background-color: var(--btn-hover);
border-radius: 8px;
padding: 20px;
margin-top: 20px;
border: 1px solid var(--sidebar-border);
}

.contact-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 16px;
}

.contact-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
}

.contact-status {
font-size: 14px;
padding: 4px 8px;
border-radius: 4px;
font-weight: 500;
}

.contact-status.pending {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

.contact-status.in-progress {
background-color: rgba(139, 92, 246, 0.1);
color: var(--backlog-color);
}

.contact-status.completed {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.contact-actions {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 16px;
}

.contact-action-btn {
display: flex;
align-items: center;
gap: 12px;
padding: 16px;
border-radius: 8px;
border: 1px solid var(--sidebar-border);
background-color: var(--card-bg);
cursor: pointer;
transition: all 0.2s;
font-size: 14px;
}

.contact-action-btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.contact-action-btn i {
font-size: 24px;
width: 30px;
text-align: center;
}

.contact-action-btn.call {
border-left: 4px solid var(--primary);
}

.contact-action-btn.call i {
color: var(--primary);
}

.contact-action-btn.whatsapp {
border-left: 4px solid #25D366;
}

.contact-action-btn.whatsapp i {
color: #25D366;
}

.contact-action-btn.validate {
border-left: 4px solid var(--warning);
}

.contact-action-btn.validate i {
color: var(--warning);
}

.contact-action-btn.schedule {
border-left: 4px solid var(--success);
}

.contact-action-btn.schedule i {
color: var(--success);
}

.contact-action-btn.backlog {
border-left: 4px solid var(--backlog-color);
}

.contact-action-btn.backlog i {
color: var(--backlog-color);
}

.contact-action-btn.derive {
border-left: 4px solid var(--primary);
}

.contact-action-btn.derive i {
color: var(--primary);
}

.contact-action-btn.cancel {
border-left: 4px solid var(--danger);
}

.contact-action-btn.cancel i {
color: var(--danger);
}

.contact-info {
font-size: 14px;
color: var(--gray-600);
margin-bottom: 16px;
}

.contact-action-content {
flex: 1;
}

.contact-action-title {
font-weight: 600;
margin-bottom: 4px;
color: var(--gray-900);
}

.contact-action-desc {
font-size: 12px;
color: var(--gray-500);
}

/* Sección de intentos de llamada */
.call-attempts {
margin-top: 20px;
}

.call-attempts-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 16px;
}

.call-attempts-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
}

.call-attempts-list {
border: 1px solid var(--sidebar-border);
border-radius: 8px;
overflow: hidden;
}

.call-attempt-item {
padding: 16px;
border-bottom: 1px solid var(--sidebar-border);
display: flex;
justify-content: space-between;
align-items: center;
}

.call-attempt-item:last-child {
border-bottom: none;
}

.call-attempt-info {
flex: 1;
}

.call-attempt-date {
font-size: 14px;
font-weight: 500;
color: var(--gray-700);
margin-bottom: 4px;
}

.call-attempt-result {
font-size: 12px;
color: var(--gray-500);
margin-bottom: 2px;
}

.call-attempt-comments {
font-size: 12px;
color: var(--gray-600);
font-style: italic;
}

.call-attempt-actions {
display: flex;
gap: 8px;
}

.call-attempt-action {
background: none;
border: none;
color: var(--gray-500);
cursor: pointer;
font-size: 16px;
padding: 6px;
border-radius: 4px;
transition: all 0.2s;
}

.call-attempt-action:hover {
background-color: var(--gray-100);
color: var(--gray-700);
}

/* Sección de validación de información */
.validation-section {
margin-top: 20px;
border: 1px solid var(--sidebar-border);
border-radius: 8px;
padding: 16px;
}

.validation-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
}

.validation-question {
margin-bottom: 16px;
}

.validation-question-label {
font-weight: 500;
color: var(--gray-700);
margin-bottom: 8px;
display: block;
}

.validation-options {
display: flex;
gap: 12px;
}

.validation-option {
display: flex;
align-items: center;
gap: 6px;
}

.validation-option input[type="radio"] {
accent-color: var(--backlog-color);
}

.validation-option label {
font-size: 14px;
color: var(--gray-600);
cursor: pointer;
}

/* Sección de speech de WhatsApp */
.whatsapp-speech {
margin-top: 20px;
border: 1px solid var(--sidebar-border);
border-radius: 8px;
padding: 16px;
}

.whatsapp-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
}

.whatsapp-content {
background-color: #f0f9ff;
border-left: 4px solid #25D366;
padding: 16px;
border-radius: 6px;
font-size: 14px;
line-height: 1.6;
color: var(--gray-800);
margin-bottom: 16px;
}

.whatsapp-actions {
display: flex;
justify-content: flex-end;
gap: 12px;
}

.whatsapp-btn {
display: flex;
align-items: center;
gap: 8px;
padding: 8px 12px;
border-radius: 6px;
font-weight: 500;
cursor: pointer;
border: none;
font-size: 14px;
transition: all 0.2s;
}

.whatsapp-btn.primary {
background-color: #25D366;
color: white;
}

.whatsapp-btn.primary:hover {
background-color: #128C7E;
}

.whatsapp-btn.secondary {
background-color: var(--card-bg);
color: var(--gray-700);
border: 1px solid var(--sidebar-border);
}

.whatsapp-btn.secondary:hover {
background-color: var(--btn-hover);
}

/* Página en desarrollo */
.development-page {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 60px 20px;
text-align: center;
}

.development-icon {
font-size: 64px;
color: var(--gray-400);
margin-bottom: 24px;
}

.development-title {
font-size: 24px;
font-weight: 600;
color: var(--gray-700);
margin-bottom: 12px;
}

.development-text {
font-size: 16px;
color: var(--gray-500);
max-width: 500px;
}

/* Estilos para la bandeja de finalizados */
.status-badge.status-completed {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.status-badge.status-satisfactory {
background-color: rgba(99, 102, 241, 0.1);
color: var(--finalizado-color);
}

.status-badge.status-observations {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

/* Estilos para el modal de órdenes finalizadas */
#finalizedOrderDetailModal .modal-content {
max-width: 900px;
}

#finalizedOrderDetailModal .detail-tabs {
display: flex;
border-bottom: 1px solid var(--table-border);
margin-bottom: 20px;
}

#finalizedOrderDetailModal .detail-tab {
padding: 16px 24px;
cursor: pointer;
font-weight: 500;
color: var(--gray-500);
border-bottom: 2px solid transparent;
transition: all 0.2s;
white-space: nowrap;
}

#finalizedOrderDetailModal .detail-tab.active {
color: var(--primary);
border-bottom-color: var(--primary);
}

#finalizedOrderDetailModal .detail-content {
display: none;
}

#finalizedOrderDetailModal .detail-content.active {
display: block;
}

#finalizedOrderDetailModal .detail-row {
display: flex;
margin-bottom: 16px;
}

#finalizedOrderDetailModal .detail-label {
width: 180px;
font-weight: 500;
color: var(--gray-600);
}

#finalizedOrderDetailModal .detail-value {
flex: 1;
color: var(--gray-800);
}

#finalizedOrderDetailModal .validation-section {
margin-top: 20px;
border: 1px solid var(--sidebar-border);
border-radius: 8px;
padding: 16px;
}

#finalizedOrderDetailModal .validation-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
}

#finalizedOrderDetailModal .timeline {
position: relative;
padding-left: 30px;
}

#finalizedOrderDetailModal .timeline::before {
content: '';
position: absolute;
left: 8px;
top: 0;
height: 100%;
width: 2px;
background-color: var(--sidebar-border);
}

#finalizedOrderDetailModal .timeline-item {
position: relative;
margin-bottom: 20px;
}

#finalizedOrderDetailModal .timeline-item::before {
content: '';
position: absolute;
left: -30px;
top: 6px;
width: 16px;
height: 16px;
border-radius: 50%;
background-color: white;
border: 2px solid var(--primary);
}

#finalizedOrderDetailModal .timeline-date {
font-size: 12px;
color: var(--gray-500);
margin-bottom: 4px;
}

#finalizedOrderDetailModal .timeline-area {
font-size: 12px;
color: var(--primary);
margin-bottom: 2px;
font-weight: 500;
}

#finalizedOrderDetailModal .timeline-user {
font-size: 12px;
color: var(--gray-600);
margin-bottom: 4px;
}

#finalizedOrderDetailModal .timeline-content {
background-color: var(--btn-hover);
padding: 12px;
border-radius: 6px;
}

/* Estilos para la calificación en la tabla */
.priority-badge.rating-high {
background-color: rgba(16, 185, 129, 0.1);
color: var(--success);
}

.priority-badge.rating-medium {
background-color: rgba(245, 158, 11, 0.1);
color: var(--warning);
}

.priority-badge.rating-low {
background-color: rgba(239, 68, 68, 0.1);
color: var(--danger);
}

/* Estilos para la página en desarrollo (para las bandejas que aún no están implementadas) */
.development-page {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 60px 20px;
text-align: center;
}

.development-icon {
font-size: 64px;
color: var(--gray-400);
margin-bottom: 24px;
}

.development-title {
font-size: 24px;
font-weight: 600;
color: var(--gray-700);
margin-bottom: 12px;
}

.development-text {
font-size: 16px;
color: var(--gray-500);
max-width: 500px;
}

/* Sección de detalles de intento de llamada */
.call-attempt-details {
margin-bottom: 20px;
}

.call-attempt-details-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
display: flex;
align-items: center;
gap: 8px;
}

.call-attempt-details-row {
margin-bottom: 12px;
}

.call-attempt-details-label {
font-weight: 500;
color: var(--gray-600);
margin-bottom: 4px;
}

.call-attempt-details-value {
color: var(--gray-800);
}

/* Sección de detalles de validación */
.validation-details-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
display: flex;
align-items: center;
gap: 8px;
}

.validation-details-row {
margin-bottom: 12px;
}

.validation-details-label {
font-weight: 500;
color: var(--gray-600);
margin-bottom: 4px;
}

.validation-details-value {
color: var(--gray-800);
}

/* Estilos para exportar a Excel */
.export-section {
margin-top: 20px;
padding: 16px;
background-color: var(--btn-hover);
border-radius: 8px;
border: 1px solid var(--sidebar-border);
}

.export-title {
font-size: 16px;
font-weight: 600;
color: var(--gray-900);
margin-bottom: 16px;
}

.export-options {
display: flex;
gap: 12px;
flex-wrap: wrap;
}

.export-btn {
display: flex;
align-items: center;
gap: 8px;
padding: 10px 16px;
border-radius: 6px;
font-weight: 500;
cursor: pointer;
border: none;
font-size: 14px;
transition: all 0.2s;
background-color: var(--card-bg);
color: var(--gray-700);
border: 1px solid var(--sidebar-border);
}

.export-btn:hover {
background-color: var(--gray-100);
}

.export-btn i {
font-size: 16px;
}

@media (max-width: 768px) {
.sidebar {
transform: translateX(-100%);
transition: transform 0.3s ease;
}

.sidebar.open {
transform: translateX(0);
}

.main-container {
margin-left: 0;
}

.container {
padding: 10px;
}

.header-top {
flex-direction: column;
gap: 16px;
align-items: flex-start;
}

.stats-container {
grid-template-columns: 1fr;
}

.table-header {
flex-direction: column;
gap: 16px;
align-items: flex-start;
}

.orders-table {
font-size: 14px;
}

.orders-table th,
.orders-table td {
padding: 10px;
}

.contact-actions {
grid-template-columns: 1fr;
gap: 12px;
}

.contact-action-btn {
padding: 12px;
}

.modal-content {
max-width: 95%;
}

.detail-tab {
padding: 12px 16px;
}
}

/* Estilos para el encabezado del dashboard */
.dashboard-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 2rem 0;
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.dashboard-header .container {
    position: relative;
    z-index: 2;
}

.dashboard-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.timestamp {
    font-size: 0.9rem;
    opacity: 0.8;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.logo-left, .logo-right {
    position: absolute;
    font-size: 1.2rem;
    font-weight: 700;
    opacity: 0.2;
    z-index: 1;
}

.logo-left {
    top: 1rem;
    left: 1rem;
}

.logo-right {
    bottom: 1rem;
    right: 1rem;
}

/* Estilos para secciones */
.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Estilos para el buscador */
.search-box {
    display: flex;
    align-items: center;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    width: 300px;
}

.search-box input {
    border: none;
    padding: 0.75rem 1rem;
    flex: 1;
    font-size: 0.9rem;
}

.search-box button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

.search-box button:hover {
    background-color: var(--primary-dark);
}

/* Estilos para valores y etiquetas de estadísticas */
.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    line-height: 1;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--gray-600);
    font-weight: 500;
}

.stat-details {
    margin-top: 1rem;
    font-size: 0.85rem;
}

.stat-details .row {
    display: flex;
    margin-bottom: 0.25rem;
}

.stat-details .row > div:first-child {
    color: var(--gray-500);
    font-weight: 500;
}

.stat-details .row > div:last-child {
    font-weight: 600;
    color: var(--gray-700);
}

/* Estilos para contratistas */
.contractor-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--gray-200);
}

.contractor-item:last-child {
    border-bottom: none;
}

.contractor-name {
    font-weight: 500;
    color: var(--gray-700);
}

.contractor-count {
    background-color: var(--primary);
    color: white;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.85rem;
}

/* Estilos para filtros de certificaciones */
.cert-date-filter {
    background-color: var(--gray-100);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.cert-date-filter .form-label {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.25rem;
}

.cert-date-filter .form-control {
    border: 1px solid var(--gray-300);
    border-radius: 4px;
}

.cert-date-filter .btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-weight: 500;
    transition: background-color 0.2s;
}

.cert-date-filter .btn:hover {
    background-color: var(--primary-dark);
}

/* Estilos para la sección de certificaciones */
.tech-card .card-body .row {
    margin-bottom: 1.5rem;
}

.tech-card .card-body .row:last-child {
    margin-bottom: 0;
}

.tech-card .card-body h5 {
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 1rem;
}

/* Estilos para la sección de agentes */
.agent-card .date-filter {
    margin-bottom: 1.5rem;
}

.agent-card .date-filter .form-label {
    font-weight: 600;
    color: var(--gray-700);
}

.agent-card .agent-item {
    transition: all 0.3s ease;
}

.agent-card .agent-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}

.agent-card .agent-initials {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

.agent-card .agent-name {
    font-size: 1.1rem;
    color: var(--gray-800);
}

.agent-card .agent-stats {
    margin-top: 0.5rem;
}

.agent-card .agent-stat-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.agent-card .agent-stat-value {
    font-size: 1rem;
    font-weight: 700;
}

.agent-card .agent-status {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

/* Estilos para la leyenda */
.legend {
    background-color: var(--gray-100);
    border-radius: 8px;
    padding: 1rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--gray-600);
}

.legend-icon {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Media queries para dispositivos móviles */
@media (max-width: 768px) {
    .dashboard-header h1 {
        font-size: 1.8rem;
    }
    
    .search-box {
        width: 100%;
        margin-top: 1rem;
    }
    
    .stat-value {
        font-size: 2rem;
    }
    
    .agent-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .agent-status {
        margin-left: 0;
    }
}
</style>
</head>
<body>
<!-- Sidebar -->
<aside class="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-title">
      <i class="fas fa-satellite-dish"></i>
      <span>SIO</span>
    </div>
  </div>

  <nav class="sidebar-menu">
    <div class="menu-module">
      <div class="module-title" onclick="toggleModule('gestion-ordenes')">
        <i class="fas fa-tasks"></i>
        <span>Torre de control</span>
        <i class="fas fa-chevron-down module-arrow"></i>
      </div>
      <div class="module-content expanded" id="gestion-ordenes">
        <a href="#" class="menu-item tcp" data-page="tcp">
          <i class="fas fa-clipboard-list"></i>
          <span>Bandeja TCP</span>
        </a>
        <a href="#" class="menu-item backlog" data-page="backlog">
          <i class="fas fa-clock"></i>
          <span>Bandeja Backlog</span>
        </a>
        <a href="#" class="menu-item" data-page="confirmados">
          <i class="fas fa-check-circle"></i>
          <span>Bandeja Confirmados</span>
        </a>
        <a href="#" class="menu-item cierre" data-page="cierre">
          <i class="fas fa-shield-alt"></i>
          <span>Bandeja Cierre Asegurado</span>
        </a>
        <a href="#" class="menu-item finalizado" data-page="finalizado">
          <i class="fas fa-flag-checkered"></i>
          <span>Bandeja Finalizado</span>
        </a>
        <a href="#" class="menu-item derivados" data-page="derivados">
          <i class="fas fa-share-alt"></i>
          <span>Bandeja Derivados</span>
        </a>
        <a href="#" class="menu-item" data-page="cancelados">
          <i class="fas fa-times-circle"></i>
          <span>Bandeja Cancelados</span>
        </a>
      </div>
      <div class="module-title" onclick="toggleModule('profiles')">
        <i class="fas fa-tasks"></i>
        <span>Perfiles</span>
        <i class="fas fa-chevron-down module-arrow"></i>
      </div>
      <div class="module-content" id="profiles">
        <a href="comercial-page.html" class="profile">
          <i class="fas fa-user"></i>
          <span>Comercial</span>
        </a>
        <a href="contrata-page.html" class="profile">
          <i class="fas fa-user"></i>
          <span>Contrata</span>
        </a>
        <a href="tce-page.html" class="profile">
          <i class="fas fa-user"></i>
          <span>TCE</span>
        </a>
      </div>
    </div>
  </nav>

  <div class="sidebar-footer">
    <p>© 2023 Sistema de Gestión de Telecomunicaciones</p>
  </div>
</aside>

<!-- Main Content -->
<main class="main-container">
<div class="container">
<header>
<div class="header-top">
<h1 class="header-title" id="pageTitle">Bandeja Finalizado - Historial de Órdenes</h1>
<div class="user-info">
<span>Agendadora: María González</span>
<div class="user-avatar">MG</div>
</div>
</div>

<div class="alert-banner" id="alertBanner">
<i class="fas fa-info-circle"></i>
<div class="alert-text" id="alertText">
<strong>25 órdenes finalizadas esta semana</strong>. Revisa el reporte de satisfacción.
</div>
<button id="criticalOrdersBtn">Ver órdenes finalizadas</button>
</div>

<div class="stats-container" id="statsContainer">
<div class="stat-card">
<div class="stat-icon total">
<i class="fas fa-clipboard-list"></i>
</div>
<div class="stat-content">
<h3>45</h3>
<p>Total órdenes</p>
</div>
</div>

<div class="stat-card">
<div class="stat-icon completed">
<i class="fas fa-smile"></i>
</div>
<div class="stat-content">
<h3>38</h3>
<p>Satisfactorias</p>
</div>
</div>

<div class="stat-card">
<div class="stat-icon critical">
<i class="fas fa-meh"></i>
</div>
<div class="stat-content">
<h3>7</h3>
<p>Con observaciones</p>
</div>
</div>
</div>
</header>

<!-- Contenedor de páginas -->
<div id="pagesContainer">
<!-- Página TCP -->
<div id="tcp-page" class="page-content" style="display: none;">
<div class="main-content">
<div class="table-header">
<h2 class="table-title">Órdenes de Trabajo</h2>
<div class="filter-actions">
<button class="filter-btn active" onclick="filterOrders('all', 'tcp')">
<i class="fas fa-list"></i> Todas
</button>
<button class="filter-btn" onclick="filterOrders('critical', 'tcp')">
<i class="fas fa-exclamation-circle"></i> Críticas
</button>
<button class="filter-btn" onclick="filterOrders('today', 'tcp')">
<i class="fas fa-calendar-day"></i> Hoy
</button>
<button class="filter-btn" onclick="filterOrders('tomorrow', 'tcp')">
<i class="fas fa-calendar-plus"></i> Mañana
</button>
</div>
</div>

<table class="orders-table">
<thead>
<tr>
<th>N° Orden</th>
<th>Cliente</th>
<th>Dirección</th>
<th>Estado</th>
<th>Fecha OFSC</th>
<th>Prioridad</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="tcpTableBody">
<tr class="order-row" data-priority="high">
<td class="order-id">ORD-001234</td>
<td>Juan Pérez</td>
<td>Av. Principal 123, Lima</td>
<td>Ingreso Pendiente</td>
<td>2023-06-15</td>
<td><span class="priority-badge priority-high">Alta</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="showOrderDetail('ORD-001234', 'tcp')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="medium">
<td class="order-id">ORD-001235</td>
<td>María López</td>
<td>Jr. Secundaria 456, Cusco</td>
<td>Ingreso Pendiente</td>
<td>2023-06-16</td>
<td><span class="priority-badge priority-medium">Media</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="showOrderDetail('ORD-001235', 'tcp')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="low">
<td class="order-id">ORD-001236</td>
<td>Carlos Mendoza</td>
<td>Av. Central 789, Arequipa</td>
<td>Ingreso Pendiente</td>
<td>2023-06-20</td>
<td><span class="priority-badge priority-low">Baja</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="showOrderDetail('ORD-001236', 'tcp')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="high">
<td class="order-id">ORD-001237</td>
<td>Ana García</td>
<td>Calle Las Flores 101, Trujillo</td>
<td>Ingreso Pendiente</td>
<td>2023-06-15</td>
<td><span class="priority-badge priority-high">Alta</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="showOrderDetail('ORD-001237', 'tcp')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="medium">
<td class="order-id">ORD-001238</td>
<td>Luis Fernández</td>
<td>Pasaje Los Pinos 202, Piura</td>
<td>Ingreso Pendiente</td>
<td>2023-06-16</td>
<td><span class="priority-badge priority-medium">Media</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="showOrderDetail('ORD-001238', 'tcp')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Página Backlog -->
<div id="backlog-page" class="page-content" style="display: none;">
<div class="main-content">
<div class="table-header">
<h2 class="table-title">Órdenes en Backlog</h2>
<div class="filter-actions">
<button class="filter-btn active" onclick="filterOrders('all', 'backlog')">
<i class="fas fa-list"></i> Todas
</button>
<button class="filter-btn" onclick="filterOrders('critical', 'backlog')">
<i class="fas fa-exclamation-circle"></i> Críticas
</button>
<button class="filter-btn" onclick="filterOrders('no-contact', 'backlog')">
<i class="fas fa-phone-slash"></i> Sin Contacto
</button>
<button class="filter-btn" onclick="filterOrders('rescheduled', 'backlog')">
<i class="fas fa-calendar-alt"></i> Reprogramadas
</button>
</div>
</div>

<table class="orders-table">
<thead>
<tr>
<th>N° Orden</th>
<th>Cliente</th>
<th>Dirección</th>
<th>Estado</th>
<th>Fecha OFSC</th>
<th>Prioridad</th>
<th>Intentos</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="backlogTableBody">
<tr class="order-row" data-priority="high" data-status="no-contact">
<td class="order-id">ORD-001234</td>
<td>Juan Pérez</td>
<td>Av. Principal 123, Lima</td>
<td><span class="status-badge status-no-contact">Sin Contacto</span></td>
<td>2023-06-15</td>
<td><span class="priority-badge priority-high">Alta</span></td>
<td><span class="attempts-badge">3 intentos</span></td>
<td>
<div class="actions">
<button class="action-btn backlog" onclick="showOrderDetail('ORD-001234', 'backlog')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="medium" data-status="rescheduled">
<td class="order-id">ORD-001235</td>
<td>María López</td>
<td>Jr. Secundaria 456, Cusco</td>
<td><span class="status-badge status-rescheduled">Reprogramada</span></td>
<td>2023-06-16</td>
<td><span class="priority-badge priority-medium">Media</span></td>
<td><span class="attempts-badge">2 intentos</span></td>
<td>
<div class="actions">
<button class="action-btn backlog" onclick="showOrderDetail('ORD-001235', 'backlog')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="low" data-status="waiting-info">
<td class="order-id">ORD-001236</td>
<td>Carlos Mendoza</td>
<td>Av. Central 789, Arequipa</td>
<td><span class="status-badge status-waiting-info">Esperando Info</span></td>
<td>2023-06-20</td>
<td><span class="priority-badge priority-low">Baja</span></td>
<td><span class="attempts-badge">1 intento</span></td>
<td>
<div class="actions">
<button class="action-btn backlog" onclick="showOrderDetail('ORD-001236', 'backlog')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="high" data-status="no-contact">
<td class="order-id">ORD-001237</td>
<td>Ana García</td>
<td>Calle Las Flores 101, Trujillo</td>
<td><span class="status-badge status-no-contact">Sin Contacto</span></td>
<td>2023-06-15</td>
<td><span class="priority-badge priority-high">Alta</span></td>
<td><span class="attempts-badge">4 intentos</span></td>
<td>
<div class="actions">
<button class="action-btn backlog" onclick="showOrderDetail('ORD-001237', 'backlog')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-priority="medium" data-status="derivated">
<td class="order-id">ORD-001238</td>
<td>Luis Fernández</td>
<td>Pasaje Los Pinos 202, Piura</td>
<td><span class="status-badge status-derivated">Derivada</span></td>
<td>2023-06-16</td>
<td><span class="priority-badge priority-medium">Media</span></td>
<td><span class="attempts-badge">2 intentos</span></td>
<td>
<div class="actions">
<button class="action-btn backlog" onclick="showOrderDetail('ORD-001238', 'backlog')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Página Confirmados -->
<div id="confirmados-page" class="page-content" style="display: none;">
<div class="main-content">
<div class="table-header">
<h2 class="table-title">Órdenes Confirmadas</h2>
<div class="filter-actions">
<button class="filter-btn active" onclick="filterOrders('all', 'confirmados')">
<i class="fas fa-list"></i> Todas
</button>
<button class="filter-btn" onclick="filterOrders('pending', 'confirmados')">
<i class="fas fa-clock"></i> Pendiente
</button>
<button class="filter-btn" onclick="filterOrders('in-progress', 'confirmados')">
<i class="fas fa-play"></i> Iniciado
</button>
<button class="filter-btn" onclick="filterOrders('reschedule-requested', 'confirmados')">
<i class="fas fa-calendar-alt"></i> Reprogramar
</button>
</div>
</div>

<!-- Alerta de órdenes fuera de horario -->
<div class="alert-banner" id="outOfScheduleAlert" style="display: none;">
<i class="fas fa-exclamation-triangle"></i>
<div class="alert-text">
<strong id="outOfScheduleCount">0</strong> órdenes fuera del horario programado. Por favor revise.
</div>
<button id="viewOutOfScheduleBtn">Ver órdenes</button>
</div>

<!-- Alerta de solicitudes de reprogramación -->
<div class="alert-banner" id="rescheduleAlert" style="display: none; background-color: rgba(59, 130, 246, 0.1); border-left-color: var(--primary);">
<i class="fas fa-info-circle" style="color: var(--primary);"></i>
<div class="alert-text">
<strong id="rescheduleCount">0</strong> solicitudes de reprogramación pendientes.
</div>
<button id="viewRescheduleBtn">Ver solicitudes</button>
</div>

<!-- Alerta de instalaciones fallidas -->
<div class="alert-banner" id="failedInstallAlert" style="display: none; background-color: rgba(239, 68, 68, 0.1); border-left-color: var(--danger);">
<i class="fas fa-times-circle" style="color: var(--danger);"></i>
<div class="alert-text">
<strong id="failedInstallCount">0</strong> instalaciones fallidas reportadas.
</div>
<button id="viewFailedInstallBtn">Ver reportes</button>
</div>

<table class="orders-table">
<thead>
<tr>
<th>N° Orden</th>
<th>Cliente</th>
<th>Dirección</th>
<th>Fecha y Hora</th>
<th>Técnico</th>
<th>Estado</th>
</tr>
</thead>
<tbody id="confirmadosTableBody">
<tr class="order-row" data-status="pending" data-schedule="2023-06-15T09:00">
<td class="order-id">ORD-001245</td>
<td>Juan Pérez</td>
<td>Av. Principal 123, Lima</td>
<td>2023-06-15 09:00</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-pending">Pendiente</span></td>
</tr>
<tr class="order-row" data-status="in-progress" data-schedule="2023-06-15T10:30">
<td class="order-id">ORD-001246</td>
<td>María López</td>
<td>Jr. Secundaria 456, Cusco</td>
<td>2023-06-15 10:30</td>
<td>Luis Fernández</td>
<td><span class="status-badge status-in-progress">Iniciado</span></td>
</tr>
<tr class="order-row" data-status="completed" data-schedule="2023-06-14T14:00">
<td class="order-id">ORD-001247</td>
<td>Ana García</td>
<td>Calle Las Flores 101, Trujillo</td>
<td>2023-06-14 14:00</td>
<td>Pedro Rodríguez</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
</tr>
<tr class="order-row" data-status="failed" data-schedule="2023-06-14T16:00">
<td class="order-id">ORD-001248</td>
<td>Rosa Martínez</td>
<td>Pasaje Los Pinos 202, Piura</td>
<td>2023-06-14 16:00</td>
<td>Jorge Ramírez</td>
<td><span class="status-badge status-failed">Fallido</span></td>
</tr>
<tr class="order-row" data-status="reschedule-requested" data-schedule="2023-06-16T11:00">
<td class="order-id">ORD-001249</td>
<td>Miguel Torres</td>
<td>Av. Central 789, Arequipa</td>
<td>2023-06-16 11:00</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-rescheduled">Reprogramar</span></td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Página Cierre Asegurado -->
<div id="cierre-page" class="page-content" style="display: none;">
<div class="main-content">
<div class="table-header">
<h2 class="table-title">Órdenes de Cierre Asegurado</h2>
<div class="filter-actions">
<button class="filter-btn active" onclick="filterOrders('all', 'cierre')">
<i class="fas fa-list"></i> Todas
</button>
<button class="filter-btn" onclick="filterOrders('pending', 'cierre')">
<i class="fas fa-clock"></i> Pendientes de Validación
</button>
<button class="filter-btn" onclick="filterOrders('validated', 'cierre')">
<i class="fas fa-check-circle"></i> Validadas
</button>
<button class="filter-btn" onclick="filterOrders('today', 'cierre')">
<i class="fas fa-calendar-day"></i> De Hoy
</button>
</div>
</div>

<!-- Alerta de órdenes sin validar -->
<div class="alert-banner" id="pendingValidationAlert" style="display: none; background-color: rgba(245, 158, 11, 0.1); border-left-color: var(--warning);">
<i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
<div class="alert-text">
<strong id="pendingValidationCount">0</strong> órdenes pendientes de validación. Prioriza su atención.
</div>
<button id="viewPendingValidationBtn">Ver órdenes pendientes</button>
</div>

<table class="orders-table">
<thead>
<tr>
<th>N° Orden</th>
<th>Cliente</th>
<th>Dirección</th>
<th>Fecha Finalización</th>
<th>Técnico</th>
<th>Estado</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="cierreTableBody">
<tr class="order-row" data-status="pending" data-completion-date="2023-06-15">
<td class="order-id">ORD-001245</td>
<td>Juan Pérez</td>
<td>Av. Principal 123, Lima</td>
<td>2023-06-15</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-pending">Pendiente de Validación</span></td>
<td>
<div class="actions">
<button class="action-btn cierre" onclick="validateInstallation('ORD-001245')">
<i class="fas fa-check"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="pending" data-completion-date="2023-06-15">
<td class="order-id">ORD-001246</td>
<td>María López</td>
<td>Jr. Secundaria 456, Cusco</td>
<td>2023-06-15</td>
<td>Luis Fernández</td>
<td><span class="status-badge status-pending">Pendiente de Validación</span></td>
<td>
<div class="actions">
<button class="action-btn cierre" onclick="validateInstallation('ORD-001246')">
<i class="fas fa-check"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="validated" data-completion-date="2023-06-14">
<td class="order-id">ORD-001247</td>
<td>Ana García</td>
<td>Calle Las Flores 101, Trujillo</td>
<td>2023-06-14</td>
<td>Pedro Rodríguez</td>
<td><span class="status-badge status-validated">Validada</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="viewValidationDetails('ORD-001247')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="pending" data-completion-date="2023-06-14">
<td class="order-id">ORD-001248</td>
<td>Rosa Martínez</td>
<td>Pasaje Los Pinos 202, Piura</td>
<td>2023-06-14</td>
<td>Jorge Ramírez</td>
<td><span class="status-badge status-pending">Pendiente de Validación</span></td>
<td>
<div class="actions">
<button class="action-btn cierre" onclick="validateInstallation('ORD-001248')">
<i class="fas fa-check"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="validated" data-completion-date="2023-06-13">
<td class="order-id">ORD-001249</td>
<td>Miguel Torres</td>
<td>Av. Central 789, Arequipa</td>
<td>2023-06-13</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-validated">Validada</span></td>
<td>
<div class="actions">
<button class="action-btn primary" onclick="viewValidationDetails('ORD-001249')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Página Finalizado -->
<div id="finalizado-page" class="page-content" style="display: none;">
<div class="main-content">
<div class="table-header">
<h2 class="table-title">Órdenes Finalizadas</h2>
<div class="filter-actions">
<button class="filter-btn active" onclick="filterOrders('all', 'finalizado')">
<i class="fas fa-list"></i> Todas
</button>
<button class="filter-btn" onclick="filterOrders('satisfactory', 'finalizado')">
<i class="fas fa-smile"></i> Satisfactorias
</button>
<button class="filter-btn" onclick="filterOrders('observations', 'finalizado')">
<i class="fas fa-exclamation-circle"></i> Con Observaciones
</button>
<button class="filter-btn" onclick="filterOrders('last-week', 'finalizado')">
<i class="fas fa-calendar-week"></i> Última Semana
</button>
</div>
</div>

<table class="orders-table">
<thead>
<tr>
<th>N° Orden</th>
<th>Cliente</th>
<th>Dirección</th>
<th>Fecha Finalización</th>
<th>Técnico</th>
<th>Estado</th>
<th>Calificación</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="finalizadoTableBody">
<tr class="order-row" data-status="satisfactory" data-completion-date="2023-06-14">
<td class="order-id">ORD-001240</td>
<td>Juan Pérez</td>
<td>Av. Principal 123, Lima</td>
<td>2023-06-14</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
<td><span class="priority-badge rating-high">5/5</span></td>
<td>
<div class="actions">
<button class="action-btn finalizado" onclick="viewFinalizedOrderDetail('ORD-001240')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="satisfactory" data-completion-date="2023-06-13">
<td class="order-id">ORD-001241</td>
<td>María López</td>
<td>Jr. Secundaria 456, Cusco</td>
<td>2023-06-13</td>
<td>Luis Fernández</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
<td><span class="priority-badge rating-high">4/5</span></td>
<td>
<div class="actions">
<button class="action-btn finalizado" onclick="viewFinalizedOrderDetail('ORD-001241')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="observations" data-completion-date="2023-06-12">
<td class="order-id">ORD-001242</td>
<td>Carlos Mendoza</td>
<td>Av. Central 789, Arequipa</td>
<td>2023-06-12</td>
<td>Pedro Rodríguez</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
<td><span class="priority-badge rating-medium">3/5</span></td>
<td>
<div class="actions">
<button class="action-btn finalizado" onclick="viewFinalizedOrderDetail('ORD-001242')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="satisfactory" data-completion-date="2023-06-11">
<td class="order-id">ORD-001243</td>
<td>Ana García</td>
<td>Calle Las Flores 101, Trujillo</td>
<td>2023-06-11</td>
<td>Jorge Ramírez</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
<td><span class="priority-badge rating-high">5/5</span></td>
<td>
<div class="actions">
<button class="action-btn finalizado" onclick="viewFinalizedOrderDetail('ORD-001243')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
<tr class="order-row" data-status="observations" data-completion-date="2023-06-10">
<td class="order-id">ORD-001244</td>
<td>Luis Fernández</td>
<td>Pasaje Los Pinos 202, Piura</td>
<td>2023-06-10</td>
<td>Carlos Mendoza</td>
<td><span class="status-badge status-completed">Finalizado</span></td>
<td><span class="priority-badge rating-low">2/5</span></td>
<td>
<div class="actions">
<button class="action-btn finalizado" onclick="viewFinalizedOrderDetail('ORD-001244')">
<i class="fas fa-eye"></i>
</button>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Página Derivados -->
<div id="derivados-page" class="page-content" style="display: none;">
  <div class="main-content">
    <div class="table-header">
      <h2 class="table-title">Órdenes Derivadas a Comercial</h2>
      <div class="filter-actions">
        <button class="filter-btn active" onclick="filterOrders('all', 'derivados')">
          <i class="fas fa-list"></i> Todas
        </button>
        <button class="filter-btn" onclick="filterOrders('pending', 'derivados')">
          <i class="fas fa-clock"></i> Pendientes
        </button>
        <button class="filter-btn" onclick="filterOrders('responded', 'derivados')">
          <i class="fas fa-reply"></i> Con Respuesta
        </button>
        <button class="filter-btn" onclick="filterOrders('recent', 'derivados')">
          <i class="fas fa-calendar-day"></i> Recientes
        </button>
      </div>
    </div>

    <!-- Alerta de órdenes pendientes de respuesta -->
    <div class="alert-banner" id="pendingResponseAlert" style="display: none; background-color: rgba(245, 158, 11, 0.1); border-left-color: var(--warning);">
      <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
      <div class="alert-text">
        <strong id="pendingResponseCount">0</strong> órdenes pendientes de respuesta comercial. Revisa su estado.
      </div>
      <button id="viewPendingResponseBtn">Ver órdenes pendientes</button>
    </div>

    <!-- Alerta de órdenes con nueva respuesta -->
    <div class="alert-banner" id="newResponseAlert" style="display: none; background-color: rgba(37, 99, 235, 0.1); border-left-color: var(--primary);">
      <i class="fas fa-info-circle" style="color: var(--primary);"></i>
      <div class="alert-text">
        <strong id="newResponseCount">0</strong> órdenes con nueva respuesta comercial. Revisa su estado.
      </div>
      <button id="viewNewResponseBtn">Ver órdenes con respuesta</button>
    </div>

    <table class="orders-table">
      <thead>
        <tr>
          <th>N° Orden</th>
          <th>Cliente</th>
          <th>Dirección</th>
          <th>Fecha Derivación</th>
          <th>Motivo Derivación</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="derivadosTableBody">
        <tr class="order-row" data-status="pending" data-derivation-date="2023-06-14">
          <td class="order-id">ORD-001250</td>
          <td>Juan Pérez</td>
          <td>Av. Principal 123, Lima</td>
          <td>2023-06-14</td>
          <td>Negociación de condiciones</td>
          <td><span class="status-badge status-pending">Pendiente</span></td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewDerivedOrderDetail('ORD-001250')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="responded" data-derivation-date="2023-06-13">
          <td class="order-id">ORD-001251</td>
          <td>María López</td>
          <td>Jr. Secundaria 456, Cusco</td>
          <td>2023-06-13</td>
          <td>Información adicional requerida</td>
          <td><span class="status-badge status-responded">Con Respuesta</span></td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewDerivedOrderDetail('ORD-001251')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="pending" data-derivation-date="2023-06-12">
          <td class="order-id">ORD-001252</td>
          <td>Carlos Mendoza</td>
          <td>Av. Central 789, Arequipa</td>
          <td>2023-06-12</td>
          <td>Cliente no localizado</td>
          <td><span class="status-badge status-pending">Pendiente</span></td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewDerivedOrderDetail('ORD-001252')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="responded" data-derivation-date="2023-06-11">
          <td class="order-id">ORD-001253</td>
          <td>Ana García</td>
          <td>Calle Las Flores 101, Trujillo</td>
          <td>2023-06-11</td>
          <td>Caso comercial especial</td>
          <td><span class="status-badge status-responded">Con Respuesta</span></td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewDerivedOrderDetail('ORD-001253')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="pending" data-derivation-date="2023-06-10">
          <td class="order-id">ORD-001254</td>
          <td>Luis Fernández</td>
          <td>Pasaje Los Pinos 202, Piura</td>
          <td>2023-06-10</td>
          <td>Requiere autorización especial</td>
          <td><span class="status-badge status-pending">Pendiente</span></td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewDerivedOrderDetail('ORD-001254')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Página Cancelados -->
<div id="cancelados-page" class="page-content" style="display: none;">
  <div class="main-content">
    <div class="table-header">
      <h2 class="table-title">Órdenes Canceladas</h2>
      <div class="filter-actions">
        <button class="filter-btn active" onclick="filterOrders('all', 'cancelados')">
          <i class="fas fa-list"></i> Todas
        </button>
        <button class="filter-btn" onclick="filterOrders('client', 'cancelados')">
          <i class="fas fa-user-times"></i> Por Cliente
        </button>
        <button class="filter-btn" onclick="filterOrders('technical', 'cancelados')">
          <i class="fas fa-tools"></i> Por Técnico
        </button>
        <button class="filter-btn" onclick="filterOrders('last-week', 'cancelados')">
          <i class="fas fa-calendar-week"></i> Última Semana
        </button>
      </div>
    </div>

    <!-- Alerta de órdenes canceladas recientemente -->
    <div class="alert-banner" id="recentCancelledAlert" style="display: none; background-color: rgba(239, 68, 68, 0.1); border-left-color: var(--danger);">
      <i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>
      <div class="alert-text">
        <strong id="recentCancelledCount">0</strong> órdenes canceladas en las últimas 24 horas. Revisa las causas.
      </div>
      <button id="viewRecentCancelledBtn">Ver órdenes recientes</button>
    </div>

    <table class="orders-table">
      <thead>
        <tr>
          <th>N° Orden</th>
          <th>Cliente</th>
          <th>Dirección</th>
          <th>Fecha Cancelación</th>
          <th>Motivo</th>
          <th>Cancelado por</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="canceladosTableBody">
        <tr class="order-row" data-status="client" data-cancellation-date="2023-06-14">
          <td class="order-id">ORD-001260</td>
          <td>Juan Pérez</td>
          <td>Av. Principal 123, Lima</td>
          <td>2023-06-14</td>
          <td>Cliente desistió del servicio</td>
          <td>María González</td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewCancelledOrderDetail('ORD-001260')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="technical" data-cancellation-date="2023-06-13">
          <td class="order-id">ORD-001261</td>
          <td>María López</td>
          <td>Jr. Secundaria 456, Cusco</td>
          <td>2023-06-13</td>
          <td>Instalación no viable</td>
          <td>Carlos Mendoza</td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewCancelledOrderDetail('ORD-001261')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="client" data-cancellation-date="2023-06-12">
          <td class="order-id">ORD-001262</td>
          <td>Carlos Mendoza</td>
          <td>Av. Central 789, Arequipa</td>
          <td>2023-06-12</td>
          <td>Sin cobertura en la zona</td>
          <td>María González</td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewCancelledOrderDetail('ORD-001262')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="technical" data-cancellation-date="2023-06-11">
          <td class="order-id">ORD-001263</td>
          <td>Ana García</td>
          <td>Calle Las Flores 101, Trujillo</td>
          <td>2023-06-11</td>
          <td>Problemas técnicos en la instalación</td>
          <td>Pedro Rodríguez</td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewCancelledOrderDetail('ORD-001263')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr class="order-row" data-status="client" data-cancellation-date="2023-06-10">
          <td class="order-id">ORD-001264</td>
          <td>Luis Fernández</td>
          <td>Pasaje Los Pinos 202, Piura</td>
          <td>2023-06-10</td>
          <td>Rechazo comercial</td>
          <td>María González</td>
          <td>
            <div class="actions">
              <button class="action-btn primary" onclick="viewCancelledOrderDetail('ORD-001264')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>
</main>

<!-- Modal Detalle de Orden -->
<div id="orderDetailModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Detalle de Orden: <span id="detailOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('orderDetailModal')">&times;</button>
</div>
<div class="modal-body">
<!-- Alerta de vencimiento si aplica -->
<div id="expirationAlert" class="expiration-alert" style="display: none;">
<i class="fas fa-exclamation-triangle"></i>
<div class="expiration-text">
Esta orden vence <strong id="expirationText">hoy</strong>. Prioriza su atención.
</div>
</div>

<div class="detail-tabs">
<div class="detail-tab active" onclick="switchTab('general')">Datos Generales</div>
<div class="detail-tab" onclick="switchTab('actions')">Acciones</div>
<div class="detail-tab" onclick="switchTab('attempts')" id="attemptsTab" style="display: none;">Intentos de Llamada</div>
<div class="detail-tab" onclick="switchTab('history')">Historial</div>
</div>

<div id="general-tab" class="detail-content active">
<div class="detail-row">
<div class="detail-label">Cliente:</div>
<div class="detail-value" id="detailCustomer">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Dirección:</div>
<div class="detail-value" id="detailAddress">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Teléfono:</div>
<div class="detail-value" id="detailPhone">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Tipo de Servicio:</div>
<div class="detail-value" id="detailServiceType">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Fecha OFSC:</div>
<div class="detail-value" id="detailOFSCDate">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Prioridad:</div>
<div class="detail-value" id="detailPriority">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Estado:</div>
<div class="detail-value" id="detailStatus">-</div>
</div>
<div class="detail-row" id="commercialResponseRow" style="display: none;">
<div class="detail-label">Respuesta Comercial:</div>
<div class="detail-value" id="detailCommercialResponse">-</div>
</div>
</div>

<div id="actions-tab" class="detail-content">
<div id="tcpActions" style="display: none;">
<div class="contact-section">
<div class="contact-header">
<h4 class="contact-title">Acciones Disponibles</h4>
<span class="contact-status pending">Pendiente de gestión</span>
</div>

<div class="contact-info">
<strong>Instrucciones:</strong> Seleccione la acción que desea realizar con esta orden después de haber contactado al cliente.
</div>

<div class="contact-actions">
<div class="contact-action-btn backlog" onclick="handleAction('backlog')">
<i class="fas fa-clock"></i>
<div class="contact-action-content">
<div class="contact-action-title">Enviar a Backlog</div>
<div class="contact-action-desc">Para reprogramar o falta de contacto</div>
</div>
</div>

<div class="contact-action-btn schedule" onclick="handleAction('schedule')">
<i class="fas fa-calendar-check"></i>
<div class="contact-action-content">
<div class="contact-action-title">Agendar Orden</div>
<div class="contact-action-desc">Confirmar fecha y hora con cliente</div>
</div>
</div>

<div class="contact-action-btn derive" onclick="handleAction('derive')">
<i class="fas fa-share-alt"></i>
<div class="contact-action-content">
<div class="contact-action-title">Derivar</div>
<div class="contact-action-desc">Enviar a comercial</div>
</div>
</div>

<div class="contact-action-btn cancel" onclick="handleAction('cancel')">
<i class="fas fa-times-circle"></i>
<div class="contact-action-content">
<div class="contact-action-title">Cancelar Orden</div>
<div class="contact-action-desc">Anular la orden definitivamente</div>
</div>
</div>
</div>
</div>
</div>

<div id="backlogActions" style="display: none;">
<div class="contact-section">
<div class="contact-header">
<h4 class="contact-title">Acciones Disponibles</h4>
<span class="contact-status pending">Pendiente de gestión</span>
</div>

<div class="contact-info">
<strong>Instrucciones:</strong> Seleccione la acción que desea realizar con esta orden.
</div>

<div class="contact-actions">
<div class="contact-action-btn call" onclick="handleAction('call')">
<i class="fas fa-phone"></i>
<div class="contact-action-content">
<div class="contact-action-title">Registrar Llamada</div>
<div class="contact-action-desc">Registrar un nuevo intento de contacto</div>
</div>
</div>

<div class="contact-action-btn whatsapp" onclick="handleAction('whatsapp')">
<i class="fab fa-whatsapp"></i>
<div class="contact-action-content">
<div class="contact-action-title">Enviar Speech</div>
<div class="contact-action-desc">Enviar mensaje por WhatsApp</div>
</div>
</div>

<div class="contact-action-btn validate" onclick="handleAction('validate')">
<i class="fas fa-check-circle"></i>
<div class="contact-action-content">
<div class="contact-action-title">Validar Información</div>
<div class="contact-action-desc">Verificar datos del cliente</div>
</div>
</div>

<div class="contact-action-btn schedule" onclick="handleAction('schedule')">
<i class="fas fa-calendar-check"></i>
<div class="contact-action-content">
<div class="contact-action-title">Agendar Orden</div>
<div class="contact-action-desc">Confirmar fecha y hora</div>
</div>
</div>

<div class="contact-action-btn backlog" onclick="handleAction('backlog')">
<i class="fas fa-clock"></i>
<div class="contact-action-content">
<div class="contact-action-title">Reprogramar</div>
<div class="contact-action-desc">Enviar a backlog con reprogramación</div>
</div>
</div>

<div class="contact-action-btn derive" onclick="handleAction('derive')">
<i class="fas fa-share-alt"></i>
<div class="contact-action-content">
<div class="contact-action-title">Derivar</div>
<div class="contact-action-desc">Enviar a comercial</div>
</div>
</div>

<div class="contact-action-btn cancel" onclick="handleAction('cancel')">
<i class="fas fa-times-circle"></i>
<div class="contact-action-content">
<div class="contact-action-title">Cancelar Orden</div>
<div class="contact-action-desc">Anular la orden definitivamente</div>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="attempts-tab" class="detail-content">
<div class="call-attempts">
<div class="call-attempts-header">
<h4 class="call-attempts-title">Intentos de Llamada</h4>
</div>

<div class="call-attempts-list" id="callAttemptsList">
<!-- Los intentos de llamada se cargarán dinámicamente -->
</div>
</div>
</div>

<div id="history-tab" class="detail-content">
<div class="timeline" id="orderTimeline">
<!-- La línea de tiempo se cargará dinámicamente -->
</div>
</div>
</div>
</div>
</div>

<!-- Modal para ver detalles de órdenes finalizadas -->
<div id="finalizedOrderDetailModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Detalle de Orden Finalizada: <span id="finalizedDetailOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('finalizedOrderDetailModal')">&times;</button>
</div>
<div class="modal-body">
<div class="detail-tabs">
<div class="detail-tab active" onclick="switchFinalizedTab('general')">Datos Generales</div>
<div class="detail-tab" onclick="switchFinalizedTab('validation')">Validación</div>
<div class="detail-tab" onclick="switchFinalizedTab('history')">Historial</div>
</div>

<div id="finalized-general-tab" class="detail-content active">
<div class="detail-row">
<div class="detail-label">Cliente:</div>
<div class="detail-value" id="finalizedDetailCustomer">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Dirección:</div>
<div class="detail-value" id="finalizedDetailAddress">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Teléfono:</div>
<div class="detail-value" id="finalizedDetailPhone">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Tipo de Servicio:</div>
<div class="detail-value" id="finalizedDetailServiceType">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Técnico:</div>
<div class="detail-value" id="finalizedDetailTechnician">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Fecha Finalización:</div>
<div class="detail-value" id="finalizedDetailCompletionDate">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Estado:</div>
<div class="detail-value" id="finalizedDetailStatus">-</div>
</div>
<div class="detail-row">
<div class="detail-label">Calificación del Cliente:</div>
<div class="detail-value" id="finalizedDetailRating">-</div>
</div>
</div>

<div id="finalized-validation-tab" class="detail-content">
<div class="validation-section">
<h4 class="validation-title">Resultados de la Validación</h4>

<div class="detail-row">
<div class="detail-label">¿Instalación correcta?</div>
<div class="detail-value" id="finalizedInstallCorrect">-</div>
</div>

<div class="detail-row">
<div class="detail-label">¿Explicación del técnico?</div>
<div class="detail-value" id="finalizedExplanation">-</div>
</div>

<div class="detail-row">
<div class="detail-label">Calificación del técnico:</div>
<div class="detail-value" id="finalizedTechnicianRating">-</div>
</div>

<div class="detail-row">
<div class="detail-label">¿Recomendaría el servicio?</div>
<div class="detail-value" id="finalizedRecommend">-</div>
</div>

<div class="detail-row">
<div class="detail-label">Comentarios del Cliente:</div>
<div class="detail-value" id="finalizedValidationComments">-</div>
</div>
</div>
</div>

<div id="finalized-history-tab" class="detail-content">
<div class="timeline" id="finalizedOrderTimeline">
<!-- La línea de tiempo se cargará dinámicamente -->
</div>
</div>
</div>
</div>
</div>

<!-- Modal Registrar Intento de Llamada -->
<div id="callAttemptModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="callAttemptModalTitle">Registrar Intento de Llamada: <span id="callAttemptOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('callAttemptModal')">&times;</button>
</div>
<div class="modal-body">
<form id="callAttemptForm">
<div class="form-group">
<label for="callDate">Fecha y Hora:</label>
<input type="datetime-local" id="callDate" class="form-control">
</div>
<div class="form-group">
<label for="callResult">Resultado:</label>
<select id="callResult" class="form-control">
<option value="">Seleccione resultado</option>
<option value="no-answer">No contestó</option>
<option value="busy">Comunicación ocupada</option>
<option value="unavailable">Número no disponible</option>
<option value="wrong-number">Número equivocado</option>
<option value="client-unavailable">Cliente no disponible</option>
<option value="callback">Devolverá la llamada</option>
<option value="contacted">Contactado</option>
</select>
</div>
<div class="form-group">
<label for="callComments">Comentarios:</label>
<textarea id="callComments" class="form-control" rows="3" placeholder="Ingrese comentarios adicionales"></textarea>
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('callAttemptModal')">Cancelar</button>
<button type="button" class="btn btn-primary" id="saveCallAttemptBtn" onclick="saveCallAttempt()">Guardar</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Ver Detalles de Intento de Llamada -->
<div id="viewCallAttemptModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Detalles del Intento de Llamada</h3>
<button class="close-btn" onclick="closeModal('viewCallAttemptModal')">&times;</button>
</div>
<div class="modal-body">
<div class="call-attempt-details">
<div class="call-attempt-details-title">
<i class="fas fa-phone-alt"></i>
<span>Información del Intento de Llamada</span>
</div>
<div class="call-attempt-details-row">
<div class="call-attempt-details-label">Fecha y Hora:</div>
<div class="call-attempt-details-value" id="viewCallDate">-</div>
</div>
<div class="call-attempt-details-row">
<div class="call-attempt-details-label">Resultado:</div>
<div class="call-attempt-details-value" id="viewCallResult">-</div>
</div>
<div class="call-attempt-details-row">
<div class="call-attempt-details-label">Comentarios:</div>
<div class="call-attempt-details-value" id="viewCallComments">-</div>
</div>
</div>

<div class="form-actions">
<button type="button" class="btn btn-primary" onclick="closeModal('viewCallAttemptModal')">Cerrar</button>
</div>
</div>
</div>
</div>

<!-- Modal Enviar Speech por WhatsApp -->
<div id="whatsappModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Enviar Speech por WhatsApp: <span id="whatsappOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('whatsappModal')">&times;</button>
</div>
<div class="modal-body">
<div class="whatsapp-speech">
<div class="whatsapp-title">Mensaje para el Cliente</div>
<div class="whatsapp-content" id="whatsappSpeech">
Estimado/a <strong id="whatsappCustomer">-</strong>,<br><br>
Le saluda María González de [Nombre de la Empresa]. Nos comunicamos con usted en relación a su orden de servicio <strong id="whatsappOrderNumber">-</strong> programada para el <strong id="whatsappOrderDate">-</strong>.<br><br>
Hemos intentado contactarle sin éxito. Por favor, confirme si desea mantener la fecha programada o prefiere reprogramar la visita.<br><br>
Puede responder directamente a este mensaje o llamarnos al [número de teléfono].<br><br>
Gracias por su atención.
</div>
</div>

<div class="form-group">
<label for="whatsappPhone">Número de WhatsApp:</label>
<input type="text" id="whatsappPhone" class="form-control" placeholder="Ingrese número de WhatsApp">
</div>

<div class="whatsapp-actions">
<button type="button" class="whatsapp-btn secondary" onclick="closeModal('whatsappModal')">Cancelar</button>
<button type="button" class="whatsapp-btn primary" onclick="sendWhatsAppMessage()">
<i class="fab fa-whatsapp"></i> Enviar Mensaje
</button>
</div>
</div>
</div>
</div>

<!-- Modal Validar Información -->
<div id="validateModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Validar Información: <span id="validateOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('validateModal')">&times;</button>
</div>
<div class="modal-body">
<div class="validation-section">
<h4 class="validation-title">Validación de Datos del Cliente</h4>

<div class="validation-question">
<div class="validation-question-label">¿El nombre del cliente es correcto?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="nameCorrect" name="nameValidation" value="correct" checked>
<label for="nameCorrect">Sí, es correcto</label>
</div>
<div class="validation-option">
<input type="radio" id="nameIncorrect" name="nameValidation" value="incorrect">
<label for="nameIncorrect">No, es incorrecto</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿La dirección es correcta?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="addressCorrect" name="addressValidation" value="correct" checked>
<label for="addressCorrect">Sí, es correcta</label>
</div>
<div class="validation-option">
<input type="radio" id="addressIncorrect" name="addressValidation" value="incorrect">
<label for="addressIncorrect">No, es incorrecta</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿El teléfono es correcto?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="phoneCorrect" name="phoneValidation" value="correct" checked>
<label for="phoneCorrect">Sí, es correcto</label>
</div>
<div class="validation-option">
<input type="radio" id="phoneIncorrect" name="phoneValidation" value="incorrect">
<label for="phoneIncorrect">No, es incorrecto</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿El tipo de servicio es correcto?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="serviceCorrect" name="serviceValidation" value="correct" checked>
<label for="serviceCorrect">Sí, es correcto</label>
</div>
<div class="validation-option">
<input type="radio" id="serviceIncorrect" name="serviceValidation" value="incorrect">
<label for="serviceIncorrect">No, es incorrecto</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿El cliente está interesado en el servicio?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="interestedYes" name="interestValidation" value="yes" checked>
<label for="interestedYes">Sí, está interesado</label>
</div>
<div class="validation-option">
<input type="radio" id="interestedNo" name="interestValidation" value="no">
<label for="interestedNo">No, no está interesado</label>
</div>
<div class="validation-option">
<input type="radio" id="interestedMaybe" name="interestValidation" value="maybe">
<label for="interestedMaybe">Tal vez, necesita más información</label>
</div>
</div>
</div>

<div class="form-group">
<label for="validationComments">Comentarios adicionales:</label>
<textarea id="validationComments" class="form-control" rows="3" placeholder="Ingrese comentarios adicionales"></textarea>
</div>

<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('validateModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="saveValidation()">Guardar Validación</button>
</div>
</div>
</div>
</div>
</div>

<!-- Modal Agendar Orden -->
<div id="scheduleModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Agendar Orden: <span id="scheduleOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('scheduleModal')">&times;</button>
</div>
<div class="modal-body">
<form id="scheduleForm">
<div class="form-group">
<label for="altPhone">Teléfono Alternativo:</label>
<input type="text" id="altPhone" class="form-control" placeholder="Ingrese teléfono alternativo">
</div>
<div class="form-group">
<label for="preferredTime">Horario Preferido:</label>
<select id="preferredTime" class="form-control">
<option value="">Seleccione horario</option>
<option value="morning">Mañana (8:00 - 12:00)</option>
<option value="afternoon">Tarde (13:00 - 17:00)</option>
<option value="evening">Noche (18:00 - 21:00)</option>
</select>
</div>
<div class="form-group">
<label for="scheduleDate">Fecha de Visita:</label>
<input type="date" id="scheduleDate" class="form-control">
</div>
<div class="form-group">
<label for="technicianComments">Comentarios para el Técnico:</label>
<textarea id="technicianComments" class="form-control" rows="3" placeholder="Ingrese comentarios importantes para el técnico"></textarea>
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('scheduleModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="saveSchedule()">Guardar y Agendar</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Enviar a Backlog (Reprogramar) -->
<div id="backlogModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Reprogramar Orden: <span id="backlogOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('backlogModal')">&times;</button>
</div>
<div class="modal-body">
<form id="backlogForm">
<div class="form-group">
<label for="backlogReason">Motivo:</label>
<select id="backlogReason" class="form-control">
<option value="">Seleccione motivo</option>
<option value="">Cliente solicita reprogramación</option>
<option value="">Cliente llega tarde y fuera del horario autorizado para ejecutar trabajos internos</option>
<option value="">Cliente ausente no agendado</option>
<option value="">Manipulación lado cliente (cables invertidos, sueltos, flojo)</option>
</select>
</div>
<div class="form-group">
<label for="backlogComment">Comentario:</label>
<textarea id="backlogComment" class="form-control" rows="3" placeholder="Ingrese un comentario detallado"></textarea>
</div>
<div class="form-group">
<label for="newDate">Nueva Fecha Tentativa:</label>
<input type="date" id="newDate" class="form-control">
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('backlogModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="sendToBacklogConfirm()">Reprogramar</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Derivar -->
<div id="deriveModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Derivar Orden: <span id="deriveOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('deriveModal')">&times;</button>
</div>
<div class="modal-body">
<div class="form-group">
<label>Datos de la Orden:</label>
<div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
<div><strong>Cliente:</strong> <span id="deriveCustomer">-</span></div>
<div><strong>Teléfono:</strong> <span id="derivePhone">-</span></div>
<div><strong>Dirección:</strong> <span id="deriveAddress">-</span></div>
<div><strong>Servicio:</strong> <span id="deriveServiceType">-</span></div>
</div>
</div>

<form id="deriveForm">
<div class="form-group">
<label for="deriveReason">Motivo:</label>
<select id="deriveReason" class="form-control">
<option value="">Seleccione motivo</option>
<option value="">Servicio operativo (Requerimiento Postventa)</option>
<option value="">Orden cancelada en oneclick</option>
  <option value="">Dirección errónea</option>
  <option value="">Error en el tipo de servicio contratado</option>
  <option value="">Venta duplicada Empresas</option>
  <option value="">Venta duplicada Hogar</option>
  <option value="">Galería / C.C. previamente bloqueado para venta</option>
  <option value="">Cliente indeciso, requiere mayor información del producto</option>
  <option value="">Aplica costos adicionales para revisión</option>
  <option value="">Cliente no desea atención (se escala a comercial)</option>
  <option value="">Cliente no solicitó el servicio</option>
  <option value="">Desiste de servicio por contraoferta</option>
  <option value="">Desiste del servicio por mundanza o cambio de local</option>
  <option value="">Servicio operativo (se realizaron pruebas)</option>
</select>
</div>
<div class="form-group">
<label for="deriveComment">Comentario:</label>
<textarea id="deriveComment" class="form-control" rows="3" placeholder="Ingrese un comentario detallado"></textarea>
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('deriveModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="sendToDeriveConfirm()">Derivar Orden</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Enviar a Cancelados -->
<div id="cancelledModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Cancelar Orden: <span id="cancelledOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('cancelledModal')">&times;</button>
</div>
<div class="modal-body">
<form id="cancelledForm">
<div class="form-group">
<label for="cancelledReason">Motivo:</label>
<select id="cancelledReason" class="form-control">
<option value="">Seleccione motivo</option>
<option value="">Orden cancelada en oneclick</option>
<option value="">Dirección errónea</option>
<option value="">Error en el tipo de servicio contratado</option>
<option value="">Venta duplicada Empresas</option>
<option value="">Venta duplicada Hogar</option>
<option value="">Galería / C.C. previamente bloqueado para venta</option>
<option value="">Aplica costos adicionales para revisión</option>
<option value="">Cliente no desea atención </option>
<option value="">Cliente no solicitó el servicio</option>
<option value="">Desiste de servicio por contraoferta</option>
<option value="">Desiste del servicio por mundanza o cambio de local</option>
<option value="">Servicio operativo (se realizaron pruebas)</option>
</select>
</div>
<div class="form-group">
<label for="cancelledComment">Comentario:</label>
<textarea id="cancelledComment" class="form-control" rows="3" placeholder="Ingrese un comentario detallado"></textarea>
</div>
<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('cancelledModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="sendToCancelledConfirm()">Cancelar Orden</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Validar Instalación (Cierre Asegurado) -->
<div id="cierreValidationModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Validar Instalación: <span id="cierreValidationOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('cierreValidationModal')">&times;</button>
</div>
<div class="modal-body">
<div class="validation-section">
<h4 class="validation-title">Datos de la Orden</h4>
<div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
<div><strong>Cliente:</strong> <span id="cierreValidationCustomer">-</span></div>
<div><strong>Dirección:</strong> <span id="cierreValidationAddress">-</span></div>
<div><strong>Técnico:</strong> <span id="cierreValidationTechnician">-</span></div>
<div><strong>Fecha Finalización:</strong> <span id="cierreValidationCompletionDate">-</span></div>
</div>
</div>

<div class="whatsapp-speech">
<div class="whatsapp-title">Speech para el Cliente</div>
<div class="whatsapp-content" id="cierreValidationSpeech">
Estimado/a <strong id="cierreValidationSpeechCustomer">-</strong>,<br><br>
Le saluda María González de [Nombre de la Empresa]. Nos comunicamos con usted en relación a la instalación de su servicio <strong id="cierreValidationSpeechService">-</strong> realizada el <strong id="cierreValidationSpeechDate">-</strong>.<br><br>
¿Podría confirmarnos si la instalación se realizó correctamente y si está satisfecho/a con el servicio?<br><br>
Agradecemos su tiempo y colaboración.
</div>
</div>

<div class="validation-section">
<h4 class="validation-title">Cuestionario de Satisfacción</h4>

<div class="validation-question">
<div class="validation-question-label">¿La instalación se realizó correctamente?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="cierreInstallCorrectYes" name="cierreInstallCorrect" value="yes" checked>
<label for="cierreInstallCorrectYes">Sí</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreInstallCorrectNo" name="cierreInstallCorrect" value="no">
<label for="cierreInstallCorrectNo">No</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿El técnico explicó correctamente el funcionamiento del servicio?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="cierreExplanationYes" name="cierreExplanation" value="yes" checked>
<label for="cierreExplanationYes">Sí</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreExplanationNo" name="cierreExplanation" value="no">
<label for="cierreExplanationNo">No</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿Cómo calificaría la atención del técnico?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="cierreTechnicianRating5" name="cierreTechnicianRating" value="5" checked>
<label for="cierreTechnicianRating5">Excelente (5)</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreTechnicianRating4" name="cierreTechnicianRating" value="4">
<label for="cierreTechnicianRating4">Buena (4)</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreTechnicianRating3" name="cierreTechnicianRating" value="3">
<label for="cierreTechnicianRating3">Regular (3)</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreTechnicianRating2" name="cierreTechnicianRating" value="2">
<label for="cierreTechnicianRating2">Mala (2)</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreTechnicianRating1" name="cierreTechnicianRating" value="1">
<label for="cierreTechnicianRating1">Muy mala (1)</label>
</div>
</div>
</div>

<div class="validation-question">
<div class="validation-question-label">¿Recomendaría nuestro servicio a otros?</div>
<div class="validation-options">
<div class="validation-option">
<input type="radio" id="cierreRecommendYes" name="cierreRecommend" value="yes" checked>
<label for="cierreRecommendYes">Sí</label>
</div>
<div class="validation-option">
<input type="radio" id="cierreRecommendNo" name="cierreRecommend" value="no">
<label for="cierreRecommendNo">No</label>
</div>
</div>
</div>

<div class="form-group">
<label for="cierreValidationComments">Comentarios adicionales:</label>
<textarea id="cierreValidationComments" class="form-control" rows="3" placeholder="Ingrese comentarios adicionales del cliente"></textarea>
</div>

<div class="form-group">
<label for="cierreValidationReason">Motivo (si el cliente no respondió la encuesta):</label>
<select id="cierreValidationReason" class="form-control">
<option value="">Seleccione motivo</option>
<option value="no-contact">No se pudo contactar al cliente</option>
<option value="client-busy">Cliente no disponible en el momento</option>
<option value="callback-pending">Pendiente de devolución de llamada</option>
<option value="not-interested">Cliente no interesado en participar</option>
</select>
</div>

<div class="form-actions">
<button type="button" class="btn btn-secondary" onclick="closeModal('cierreValidationModal')">Cancelar</button>
<button type="button" class="btn btn-primary" onclick="saveCierreValidation()">Guardar Validación</button>
</div>
</div>
</div>
</div>
</div>

<!-- Modal Ver Detalles de Validación (Cierre Asegurado) -->
<div id="viewCierreValidationModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Detalles de Validación: <span id="viewCierreValidationOrderId"></span></h3>
<button class="close-btn" onclick="closeModal('viewCierreValidationModal')">&times;</button>
</div>
<div class="modal-body">
<div class="validation-section">
<h4 class="validation-title">Información de la Orden</h4>
<div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
<div><strong>Cliente:</strong> <span id="viewCierreValidationCustomer">-</span></div>
<div><strong>Dirección:</strong> <span id="viewCierreValidationAddress">-</span></div>
<div><strong>Técnico:</strong> <span id="viewCierreValidationTechnician">-</span></div>
<div><strong>Fecha Finalización:</strong> <span id="viewCierreValidationCompletionDate">-</span></div>
<div><strong>Fecha Validación:</strong> <span id="viewCierreValidationDate">-</span></div>
</div>
</div>

<div class="validation-section">
<h4 class="validation-title">Resultados de la Validación</h4>

<div class="detail-row">
<div class="detail-label">¿Instalación correcta?</div>
<div class="detail-value" id="viewCierreInstallCorrect">-</div>
</div>

<div class="detail-row">
<div class="detail-label">¿Explicación del técnico?</div>
<div class="detail-value" id="viewCierreExplanation">-</div>
</div>

<div class="detail-row">
<div class="detail-label">Calificación del técnico:</div>
<div class="detail-value" id="viewCierreTechnicianRating">-</div>
</div>

<div class="detail-row">
<div class="detail-label">¿Recomendaría el servicio?</div>
<div class="detail-value" id="viewCierreRecommend">-</div>
</div>

<div class="detail-row">
<div class="detail-label">Comentarios:</div>
<div class="detail-value" id="viewCierreValidationComments">-</div>
</div>

<div class="detail-row" id="viewCierreValidationReasonRow" style="display: none;">
<div class="detail-label">Motivo:</div>
<div class="detail-value" id="viewCierreValidationReason">-</div>
</div>
</div>

<div class="form-actions">
<button type="button" class="btn btn-primary" onclick="closeModal('viewCierreValidationModal')">Cerrar</button>
</div>
</div>
</div>
</div>

<!-- Modal Detalle de Orden Derivada -->
<div id="derivedOrderDetailModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Detalle de Orden Derivada: <span id="derivedDetailOrderId"></span></h3>
      <button class="close-btn" onclick="closeModal('derivedOrderDetailModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="detail-tabs">
        <div class="detail-tab active" onclick="switchDerivedTab('general')">Datos Generales</div>
        <div class="detail-tab" onclick="switchDerivedTab('derivation')">Información de Derivación</div>
        <div class="detail-tab" onclick="switchDerivedTab('response')">Respuesta Comercial</div>
        <div class="detail-tab" onclick="switchDerivedTab('history')">Historial</div>
      </div>

      <div id="derived-general-tab" class="detail-content active">
        <div class="detail-row">
          <div class="detail-label">Cliente:</div>
          <div class="detail-value" id="derivedDetailCustomer">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Dirección:</div>
          <div class="detail-value" id="derivedDetailAddress">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Teléfono:</div>
          <div class="detail-value" id="derivedDetailPhone">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Tipo de Servicio:</div>
          <div class="detail-value" id="derivedDetailServiceType">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Fecha OFSC:</div>
          <div class="detail-value" id="derivedDetailOFSCDate">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Prioridad:</div>
          <div class="detail-value" id="derivedDetailPriority">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Estado Actual:</div>
          <div class="detail-value" id="derivedDetailStatus">-</div>
        </div>
      </div>

      <div id="derived-derivation-tab" class="detail-content">
        <div class="detail-row">
          <div class="detail-label">Fecha de Derivación:</div>
          <div class="detail-value" id="derivedDetailDerivationDate">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Motivo de Derivación:</div>
          <div class="detail-value" id="derivedDetailDerivationReason">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Comentarios de Derivación:</div>
          <div class="detail-value" id="derivedDetailDerivationComments">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Derivado por:</div>
          <div class="detail-value" id="derivedDetailDerivationUser">-</div>
        </div>
      </div>

      <div id="derived-response-tab" class="detail-content">
        <div id="responsePendingSection" style="display: none;">
          <div class="validation-section">
            <h4 class="validation-title">Respuesta Comercial</h4>
            <p style="color: var(--gray-600); margin-bottom: 16px;">Esta orden aún no tiene respuesta del área comercial.</p>
          </div>
        </div>

        <div id="responseReceivedSection" style="display: none;">
          <div class="validation-section">
            <h4 class="validation-title">Respuesta Comercial</h4>
            
            <div class="detail-row">
              <div class="detail-label">Fecha de Respuesta:</div>
              <div class="detail-value" id="derivedDetailResponseDate">-</div>
            </div>
            
            <div class="detail-row">
              <div class="detail-label">Respondido por:</div>
              <div class="detail-value" id="derivedDetailResponseUser">-</div>
            </div>
            
            <div class="detail-row">
              <div class="detail-label">Resultado:</div>
              <div class="detail-value" id="derivedDetailResponseResult">-</div>
            </div>
            
            <div class="detail-row">
              <div class="detail-label">Comentarios:</div>
              <div class="detail-value" id="derivedDetailResponseComments">-</div>
            </div>
            
            <div class="detail-row">
              <div class="detail-label">Información Adicional:</div>
              <div class="detail-value" id="derivedDetailAdditionalInfo">-</div>
            </div>
          </div>
        </div>
      </div>

      <div id="derived-history-tab" class="detail-content">
        <div class="timeline" id="derivedOrderTimeline">
          <!-- La línea de tiempo se cargará dinámicamente -->
        </div>
      </div>

      <!-- Sección de acciones según el estado -->
      <div class="contact-section" style="margin-top: 24px;">
        <div class="contact-header">
          <h4 class="contact-title">Acciones Disponibles</h4>
          <span class="contact-status pending" id="derivedOrderStatus">Pendiente de gestión</span>
        </div>

        <div class="contact-actions" id="derivedOrderActions">
          <!-- Las acciones se cargarán dinámicamente según el estado -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Anular Orden Derivada -->
<div id="cancelDerivedModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Anular Orden Derivada: <span id="cancelDerivedOrderId"></span></h3>
      <button class="close-btn" onclick="closeModal('cancelDerivedModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Datos de la Orden:</label>
        <div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
          <div><strong>Cliente:</strong> <span id="cancelDerivedCustomer">-</span></div>
          <div><strong>Dirección:</strong> <span id="cancelDerivedAddress">-</span></div>
          <div><strong>Servicio:</strong> <span id="cancelDerivedServiceType">-</span></div>
        </div>
      </div>

      <form id="cancelDerivedForm">
        <div class="form-group">
          <label for="cancelDerivedReason">Motivo de Anulación:</label>
          <select id="cancelDerivedReason" class="form-control">
            <option value="">Seleccione motivo</option>
            <option value="">Orden cancelada en oneclick</option>
            <option value="">Dirección errónea</option>
            <option value="">Error en el tipo de servicio contratado</option>
            <option value="">Venta duplicada Empresas</option>
            <option value="">Venta duplicada Hogar</option>
            <option value="">Galería / C.C. previamente bloqueado para venta</option>
            <option value="">Aplica costos adicionales para revisión</option>
            <option value="">Cliente no desea atención </option>
            <option value="">Cliente no solicitó el servicio</option>
            <option value="">Desiste de servicio por contraoferta</option>
            <option value="">Desiste del servicio por mundanza o cambio de local</option>
            <option value="">Servicio operativo (se realizaron pruebas)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cancelDerivedComments">Comentarios:</label>
          <textarea id="cancelDerivedComments" class="form-control" rows="3" placeholder="Ingrese un comentario detallado"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('cancelDerivedModal')">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="cancelDerivedOrderConfirm()">Anular Orden</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Derivar Nuevamente Orden -->
<div id="rederiveModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Derivar Nuevamente Orden: <span id="rederiveOrderId"></span></h3>
      <button class="close-btn" onclick="closeModal('rederiveModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Datos de la Orden:</label>
        <div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
          <div><strong>Cliente:</strong> <span id="rederiveCustomer">-</span></div>
          <div><strong>Dirección:</strong> <span id="rederiveAddress">-</span></div>
          <div><strong>Servicio:</strong> <span id="rederiveServiceType">-</span></div>
        </div>
      </div>

      <form id="rederiveForm">
        <div class="form-group">
          <label for="rederiveReason">Motivo de Nueva Derivación:</label>
          <select id="rederiveReason" class="form-control">
            <option value="">Seleccione motivo</option>
            <option value="">Orden cancelada en oneclick</option>
            <option value="">Servicio operativo (Requerimiento Postventa)</option>
            <option value="">Dirección errónea</option>
            <option value="">Error en el tipo de servicio contratado</option>
            <option value="">Venta duplicada Empresas</option>
            <option value="">Venta duplicada Hogar</option>
            <option value="">Galería / C.C. previamente bloqueado para venta</option>
            <option value="">Cliente indeciso, requiere mayor información del producto</option>
            <option value="">Aplica costos adicionales para revisión</option>
            <option value="">Cliente no desea atención (se escala a comercial)</option>
            <option value="">Cliente no solicitó el servicio</option>
            <option value="">Desiste de servicio por contraoferta</option>
            <option value="">Desiste del servicio por mundanza o cambio de local</option>
            <option value="">Servicio operativo (se realizaron pruebas)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="rederiveComments">Comentarios:</label>
          <textarea id="rederiveComments" class="form-control" rows="3" placeholder="Ingrese un comentario detallado"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('rederiveModal')">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="rederiveOrderConfirm()">Derivar Orden</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Retomar Orden (Enviar a Backlog) -->
<div id="resumeOrderModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Retomar Orden: <span id="resumeOrderId"></span></h3>
      <button class="close-btn" onclick="closeModal('resumeOrderModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Datos de la Orden:</label>
        <div style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
          <div><strong>Cliente:</strong> <span id="resumeCustomer">-</span></div>
          <div><strong>Dirección:</strong> <span id="resumeAddress">-</span></div>
          <div><strong>Servicio:</strong> <span id="resumeServiceType">-</span></div>
        </div>
      </div>

      <div class="validation-section">
        <h4 class="validation-title">Información Comercial Recibida</h4>
        <div id="resumeCommercialInfo" style="background-color: var(--btn-hover); padding: 12px; border-radius: 6px; margin-bottom: 16px; border: 1px solid var(--sidebar-border);">
          <!-- La información comercial se cargará dinámicamente -->
        </div>
      </div>

      <form id="resumeOrderForm">
        <div class="form-group">
          <label for="resumeComments">Comentarios adicionales:</label>
          <textarea id="resumeComments" class="form-control" rows="3" placeholder="Ingrese comentarios adicionales para la retomada de la orden"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('resumeOrderModal')">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="resumeOrderConfirm()">Retomar Orden</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Detalle de Orden Cancelada -->
<div id="cancelledOrderDetailModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Detalle de Orden Cancelada: <span id="cancelledDetailOrderId"></span></h3>
      <button class="close-btn" onclick="closeModal('cancelledOrderDetailModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="detail-tabs">
        <div class="detail-tab active" onclick="switchCancelledTab('general')">Datos Generales</div>
        <div class="detail-tab" onclick="switchCancelledTab('cancellation')">Información de Cancelación</div>
        <div class="detail-tab" onclick="switchCancelledTab('history')">Historial</div>
      </div>

      <div id="cancelled-general-tab" class="detail-content active">
        <div class="detail-row">
          <div class="detail-label">Cliente:</div>
          <div class="detail-value" id="cancelledDetailCustomer">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Dirección:</div>
          <div class="detail-value" id="cancelledDetailAddress">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Teléfono:</div>
          <div class="detail-value" id="cancelledDetailPhone">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Tipo de Servicio:</div>
          <div class="detail-value" id="cancelledDetailServiceType">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Fecha OFSC:</div>
          <div class="detail-value" id="cancelledDetailOFSCDate">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Prioridad:</div>
          <div class="detail-value" id="cancelledDetailPriority">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Estado Actual:</div>
          <div class="detail-value" id="cancelledDetailStatus">-</div>
        </div>
      </div>

      <div id="cancelled-cancellation-tab" class="detail-content">
        <div class="detail-row">
          <div class="detail-label">Fecha de Cancelación:</div>
          <div class="detail-value" id="cancelledDetailCancellationDate">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Cancelado por:</div>
          <div class="detail-value" id="cancelledDetailCancelledBy">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Motivo de Cancelación:</div>
          <div class="detail-value" id="cancelledDetailCancellationReason">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Comentarios:</div>
          <div class="detail-value" id="cancelledDetailCancellationComments">-</div>
        </div>
      </div>

      <div id="cancelled-history-tab" class="detail-content">
        <div class="timeline" id="cancelledOrderTimeline">
          <!-- La línea de tiempo se cargará dinámicamente -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Datos de ejemplo para las órdenes TCP
const tcpOrdersData = {
'ORD-001234': {
customer: 'Juan Pérez',
address: 'Av. Principal 123, Lima',
phone: '987654321',
serviceType: 'Instalación de Internet',
ofscDate: '2023-06-15',
priority: 'Alta',
status: 'Ingreso Pendiente'
},
'ORD-001235': {
customer: 'María López',
address: 'Jr. Secundaria 456, Cusco',
phone: '987654322',
serviceType: 'Reparación de línea',
ofscDate: '2023-06-16',
priority: 'Media',
status: 'Ingreso Pendiente'
},
'ORD-001236': {
customer: 'Carlos Mendoza',
address: 'Av. Central 789, Arequipa',
phone: '987654323',
serviceType: 'Cambio de equipo',
ofscDate: '2023-06-20',
priority: 'Baja',
status: 'Ingreso Pendiente'
},
'ORD-001237': {
customer: 'Ana García',
address: 'Calle Las Flores 101, Trujillo',
phone: '987654324',
serviceType: 'Instalación de TV',
ofscDate: '2023-06-15',
priority: 'Alta',
status: 'Ingreso Pendiente'
},
'ORD-001238': {
customer: 'Luis Fernández',
address: 'Pasaje Los Pinos 202, Piura',
phone: '987654325',
serviceType: 'Migración de servicio',
ofscDate: '2023-06-16',
priority: 'Media',
status: 'Ingreso Pendiente'
}
};

// Datos de ejemplo para las órdenes Backlog
const backlogOrdersData = {
'ORD-001234': {
customer: 'Juan Pérez',
address: 'Av. Principal 123, Lima',
phone: '987654321',
serviceType: 'Instalación de Internet',
ofscDate: '2023-06-15',
priority: 'Alta',
status: 'Sin Contacto',
commercialResponse: 'N/A'
},
'ORD-001235': {
customer: 'María López',
address: 'Jr. Secundaria 456, Cusco',
phone: '987654322',
serviceType: 'Reparación de línea',
ofscDate: '2023-06-16',
priority: 'Media',
status: 'Reprogramada',
commercialResponse: 'N/A'
},
'ORD-001236': {
customer: 'Carlos Mendoza',
address: 'Av. Central 789, Arequipa',
phone: '987654323',
serviceType: 'Cambio de equipo',
ofscDate: '2023-06-20',
priority: 'Baja',
status: 'Esperando Info',
commercialResponse: 'N/A'
},
'ORD-001237': {
customer: 'Ana García',
address: 'Calle Las Flores 101, Trujillo',
phone: '987654324',
serviceType: 'Instalación de TV',
ofscDate: '2023-06-15',
priority: 'Alta',
status: 'Sin Contacto',
commercialResponse: 'N/A'
},
'ORD-001238': {
customer: 'Luis Fernández',
address: 'Pasaje Los Pinos 202, Piura',
phone: '987654325',
serviceType: 'Migración de servicio',
ofscDate: '2023-06-16',
priority: 'Media',
status: 'Derivada',
commercialResponse: 'Cliente requiere negociación de condiciones'
}
};

// Datos de ejemplo para las órdenes de cierre
const cierreOrdersData = {
'ORD-001245': {
customer: 'Juan Pérez',
address: 'Av. Principal 123, Lima',
technician: 'Carlos Mendoza',
completionDate: '2023-06-15',
serviceType: 'Instalación de Internet',
status: 'Pendiente de Validación'
},
'ORD-001246': {
customer: 'María López',
address: 'Jr. Secundaria 456, Cusco',
technician: 'Luis Fernández',
completionDate: '2023-06-15',
serviceType: 'Instalación de TV',
status: 'Pendiente de Validación'
},
'ORD-001247': {
customer: 'Ana García',
address: 'Calle Las Flores 101, Trujillo',
technician: 'Pedro Rodríguez',
completionDate: '2023-06-14',
serviceType: 'Reparación de línea',
status: 'Validada',
validationDate: '2023-06-14 16:30',
installCorrect: 'Sí',
explanation: 'Sí',
technicianRating: '5',
recommend: 'Sí',
comments: 'Cliente muy satisfecho con la instalación',
reason: ''
},
'ORD-001248': {
customer: 'Rosa Martínez',
address: 'Pasaje Los Pinos 202, Piura',
technician: 'Jorge Ramírez',
completionDate: '2023-06-14',
serviceType: 'Cambio de equipo',
status: 'Pendiente de Validación'
},
'ORD-001249': {
customer: 'Miguel Torres',
address: 'Av. Central 789, Arequipa',
technician: 'Carlos Mendoza',
completionDate: '2023-06-13',
serviceType: 'Migración de servicio',
status: 'Validada',
validationDate: '2023-06-13 18:15',
installCorrect: 'No',
explanation: 'No',
technicianRating: '2',
recommend: 'No',
comments: 'El técnico no explicó correctamente el funcionamiento del nuevo servicio',
reason: 'Cliente no interesado en participar'
}
};

// Datos de ejemplo para las órdenes finalizadas
const finalizedOrdersData = {
'ORD-001240': {
customer: 'Juan Pérez',
address: 'Av. Principal 123, Lima',
phone: '987654321',
serviceType: 'Instalación de Internet',
technician: 'Carlos Mendoza',
completionDate: '2023-06-14',
status: 'Finalizado',
rating: '5/5',
installCorrect: 'Sí',
explanation: 'Sí',
technicianRating: '5',
recommend: 'Sí',
comments: 'Excelente servicio, muy satisfecho con la instalación'
},
'ORD-001241': {
customer: 'María López',
address: 'Jr. Secundaria 456, Cusco',
phone: '987654322',
serviceType: 'Reparación de línea',
technician: 'Luis Fernández',
completionDate: '2023-06-13',
status: 'Finalizado',
rating: '4/5',
installCorrect: 'Sí',
explanation: 'Sí',
technicianRating: '4',
recommend: 'Sí',
comments: 'Buen servicio, el técnico fue muy amable'
},
'ORD-001242': {
customer: 'Carlos Mendoza',
address: 'Av. Central 789, Arequipa',
phone: '987654323',
serviceType: 'Cambio de equipo',
technician: 'Pedro Rodríguez',
completionDate: '2023-06-12',
status: 'Finalizado',
rating: '3/5',
installCorrect: 'Sí',
explanation: 'No',
technicianRating: '3',
recommend: 'Tal vez',
comments: 'El servicio fue correcto pero el técnico no explicó bien el funcionamiento'
},
'ORD-001243': {
customer: 'Ana García',
address: 'Calle Las Flores 101, Trujillo',
phone: '987654324',
serviceType: 'Instalación de TV',
technician: 'Jorge Ramírez',
completionDate: '2023-06-11',
status: 'Finalizado',
rating: '5/5',
installCorrect: 'Sí',
explanation: 'Sí',
technicianRating: '5',
recommend: 'Sí',
comments: 'Servicio impecable, muy contenta con el resultado'
},
'ORD-001244': {
customer: 'Luis Fernández',
address: 'Pasaje Los Pinos 202, Piura',
phone: '987654325',
serviceType: 'Migración de servicio',
technician: 'Carlos Mendoza',
completionDate: '2023-06-10',
status: 'Finalizado',
rating: '2/5',
installCorrect: 'No',
explanation: 'No',
technicianRating: '2',
recommend: 'No',
comments: 'La instalación tuvo problemas y el técnico no resolvió adecuadamente'
}
};

// Datos de ejemplo para las órdenes derivadas
const derivedOrdersData = {
  'ORD-001250': {
    customer: 'Juan Pérez',
    address: 'Av. Principal 123, Lima',
    phone: '987654321',
    serviceType: 'Instalación de Internet',
    ofscDate: '2023-06-15',
    priority: 'Alta',
    status: 'Pendiente',
    derivationDate: '2023-06-14',
    derivationReason: 'Negociación de condiciones',
    derivationComments: 'Cliente requiere condiciones especiales de pago',
    derivationUser: 'María González',
    responseDate: null,
    responseUser: null,
    responseResult: null,
    responseComments: null,
    additionalInfo: null
  },
  'ORD-001251': {
    customer: 'María López',
    address: 'Jr. Secundaria 456, Cusco',
    phone: '987654322',
    serviceType: 'Reparación de línea',
    ofscDate: '2023-06-16',
    priority: 'Media',
    status: 'Con Respuesta',
    derivationDate: '2023-06-13',
    derivationReason: 'Información adicional requerida',
    derivationComments: 'Se necesita confirmar tipo de instalación',
    derivationUser: 'María González',
    responseDate: '2023-06-14 10:30',
    responseUser: 'Carlos Rodríguez',
    responseResult: 'Información proporcionada',
    responseComments: 'Se confirmó que el cliente requiere instalación tipo empresarial',
    additionalInfo: 'El cliente tiene un negocio pequeño y necesita conexión estable'
  },
  'ORD-001252': {
    customer: 'Carlos Mendoza',
    address: 'Av. Central 789, Arequipa',
    phone: '987654323',
    serviceType: 'Cambio de equipo',
    ofscDate: '2023-06-20',
    priority: 'Baja',
    status: 'Pendiente',
    derivationDate: '2023-06-12',
    derivationReason: 'Cliente no localizado',
    derivationComments: 'No se pudo contactar al cliente en la dirección proporcionada',
    derivationUser: 'María González',
    responseDate: null,
    responseUser: null,
    responseResult: null,
    responseComments: null,
    additionalInfo: null
  },
  'ORD-001253': {
    customer: 'Ana García',
    address: 'Calle Las Flores 101, Trujillo',
    phone: '987654324',
    serviceType: 'Instalación de TV',
    ofscDate: '2023-06-15',
    priority: 'Alta',
    status: 'Con Respuesta',
    derivationDate: '2023-06-11',
    derivationReason: 'Caso comercial especial',
    derivationComments: 'Cliente solicita paquete premium con descuento',
    derivationUser: 'María González',
    responseDate: '2023-06-12 15:45',
    responseUser: 'Carlos Rodríguez',
    responseResult: 'Aprobado con condiciones',
    responseComments: 'Se aprobó el paquete premium con 15% de descuento por 6 meses',
    additionalInfo: 'El cliente debe firmar contrato por 18 meses'
  },
  'ORD-001254': {
    customer: 'Luis Fernández',
    address: 'Pasaje Los Pinos 202, Piura',
    phone: '987654325',
    serviceType: 'Migración de servicio',
    ofscDate: '2023-06-16',
    priority: 'Media',
    status: 'Pendiente',
    derivationDate: '2023-06-10',
    derivationReason: 'Requiere autorización especial',
    derivationComments: 'Cliente necesita autorización para migración de servicio corporativo',
    derivationUser: 'María González',
    responseDate: null,
    responseUser: null,
    responseResult: null,
    responseComments: null,
    additionalInfo: null
  }
};

// Variable para almacenar la orden actual en detalle
let currentOrderId = null;
let currentPage = 'finalizado';
let editingAttemptIndex = null; // Variable para almacenar el índice del intento que se está editando

// Datos de trazabilidad por orden
const orderTimelineData = {
'ORD-001234': [
{ date: '2023-06-10 10:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-12 14:15', area: 'Atención al Cliente', user: 'María González', content: 'Enviada a backlog por falta de contacto' },
{ date: '2023-06-13 11:20', area: 'Atención al Cliente', user: 'María González', content: 'Primer intento de contacto fallido: No contestó' },
{ date: '2023-06-14 09:45', area: 'Atención al Cliente', user: 'María González', content: 'Segundo intento de contacto fallido: Número no disponible' }
],
'ORD-001235': [
{ date: '2023-06-11 09:15', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-13 11:20', area: 'Atención al Cliente', user: 'María González', content: 'Enviada a backlog por reprogramación' },
{ date: '2023-06-14 15:30', area: 'Atención al Cliente', user: 'María González', content: 'Contacto con cliente realizado: Cliente solicita reprogramación' }
],
'ORD-001236': [
{ date: '2023-06-09 14:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-12 10:15', area: 'Atención al Cliente', user: 'María González', content: 'Enviada a backlog por falta de información' }
],
'ORD-001237': [
{ date: '2023-06-10 16:45', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-12 14:20', area: 'Atención al Cliente', user: 'María González', content: 'Enviada a backlog por falta de contacto' },
{ date: '2023-06-13 09:10', area: 'Atención al Cliente', user: 'María González', content: 'Primer intento de contacto fallido: No contestó' },
{ date: '2023-06-14 11:30', area: 'Atención al Cliente', user: 'María González', content: 'Segundo intento de contacto fallido: Número no disponible' }
],
'ORD-001238': [
{ date: '2023-06-12 13:20', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-13 10:45', area: 'Atención al Cliente', user: 'María González', content: 'Enviada a backlog por falta de contacto' },
{ date: '2023-06-14 14:30', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Derivada a comercial por negociación: Cliente requiere condiciones especiales' }
],
// Datos de trazabilidad para órdenes de cierre
'ORD-001245': [
{ date: '2023-06-10 10:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-14 16:45', area: 'Contrata', user: 'Carlos Mendoza', content: 'Instalación completada' },
{ date: '2023-06-15 09:00', area: 'Sistema', user: 'Sistema', content: 'Orden enviada a Cierre Asegurado' }
],
'ORD-001246': [
{ date: '2023-06-11 09:15', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-14 17:30', area: 'Contrata', user: 'Luis Fernández', content: 'Instalación completada' },
{ date: '2023-06-15 09:00', area: 'Sistema', user: 'Sistema', content: 'Orden enviada a Cierre Asegurado' }
],
'ORD-001247': [
{ date: '2023-06-09 14:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-13 16:00', area: 'Contrata', user: 'Pedro Rodríguez', content: 'Instalación completada' },
{ date: '2023-06-14 09:00', area: 'Sistema', user: 'Sistema', content: 'Orden enviada a Cierre Asegurado' },
{ date: '2023-06-14 16:30', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 5/5' }
],
'ORD-001248': [
{ date: '2023-06-10 16:45', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-13 18:15', area: 'Contrata', user: 'Jorge Ramírez', content: 'Instalación completada' },
{ date: '2023-06-14 09:00', area: 'Sistema', user: 'Sistema', content: 'Orden enviada a Cierre Asegurado' }
],
'ORD-001249': [
{ date: '2023-06-08 13:20', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-12 15:45', area: 'Contrata', user: 'Carlos Mendoza', content: 'Instalación completada' },
{ date: '2023-06-13 09:00', area: 'Sistema', user: 'Sistema', content: 'Orden enviada a Cierre Asegurado' },
{ date: '2023-06-13 18:15', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 2/5' }
],
// Datos de trazabilidad para órdenes finalizadas
'ORD-001240': [
{ date: '2023-06-10 10:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-12 14:15', area: 'Atención al Cliente', user: 'María González', content: 'Orden agendada para instalación' },
{ date: '2023-06-14 16:45', area: 'Contrata', user: 'Carlos Mendoza', content: 'Instalación completada' },
{ date: '2023-06-14 17:30', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 5/5' },
{ date: '2023-06-14 18:00', area: 'Sistema', user: 'Sistema', content: 'Orden marcada como finalizada' }
],
'ORD-001241': [
{ date: '2023-06-09 09:15', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-11 14:20', area: 'Atención al Cliente', user: 'María González', content: 'Orden agendada para reparación' },
{ date: '2023-06-13 15:30', area: 'Contrata', user: 'Luis Fernández', content: 'Reparación completada' },
{ date: '2023-06-13 16:45', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 4/5' },
{ date: '2023-06-13 17:00', area: 'Sistema', user: 'Sistema', content: 'Orden marcada como finalizada' }
],
'ORD-001242': [
{ date: '2023-06-08 14:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-10 10:15', area: 'Atención al Cliente', user: 'María González', content: 'Orden agendada para cambio de equipo' },
{ date: '2023-06-12 13:45', area: 'Contrata', user: 'Pedro Rodríguez', content: 'Cambio de equipo completado' },
{ date: '2023-06-12 15:30', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 3/5' },
{ date: '2023-06-12 16:00', area: 'Sistema', user: 'Sistema', content: 'Orden marcada como finalizada' }
],
'ORD-001243': [
{ date: '2023-06-07 16:45', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-09 11:20', area: 'Atención al Cliente', user: 'María González', content: 'Orden agendada para instalación' },
{ date: '2023-06-11 14:00', area: 'Contrata', user: 'Jorge Ramírez', content: 'Instalación completada' },
{ date: '2023-06-11 15:45', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 5/5' },
{ date: '2023-06-11 16:00', area: 'Sistema', user: 'Sistema', content: 'Orden marcada como finalizada' }
],
'ORD-001244': [
{ date: '2023-06-06 13:20', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
{ date: '2023-06-08 10:45', area: 'Atención al Cliente', user: 'María González', content: 'Orden agendada para migración' },
{ date: '2023-06-10 15:15', area: 'Contrata', user: 'Carlos Mendoza', content: 'Migración completada' },
{ date: '2023-06-10 17:30', area: 'Atención al Cliente', user: 'María González', content: 'Validación de instalación completada - Calificación del técnico: 2/5' },
{ date: '2023-06-10 18:00', area: 'Sistema', user: 'Sistema', content: 'Orden marcada como finalizada' }
]

};

// Agregar datos de prueba para el historial de órdenes derivadas
const derivedOrderTimelineData = {
  'ORD-001250': [
    { date: '2023-06-10 10:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-14 09:15', area: 'Atención al Cliente', user: 'María González', content: 'Orden derivada a Comercial: Negociación de condiciones' },
    { date: '2023-06-14 10:00', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Recepción de derivación: Se inicia negociación con cliente' }
  ],
  'ORD-001251': [
    { date: '2023-06-09 14:20', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-13 11:30', area: 'Atención al Cliente', user: 'María González', content: 'Orden derivada a Comercial: Información adicional requerida' },
    { date: '2023-06-13 14:00', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Recepción de derivación: Se contacta al cliente para obtener información' },
    { date: '2023-06-14 10:30', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Respuesta comercial: Información proporcionada - Cliente requiere instalación tipo empresarial' }
  ],
  'ORD-001252': [
    { date: '2023-06-08 16:45', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-12 09:20', area: 'Atención al Cliente', user: 'María González', content: 'Orden derivada a Comercial: Cliente no localizado' },
    { date: '2023-06-12 10:30', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Recepción de derivación: Se intenta localizar al cliente sin éxito' }
  ],
  'ORD-001253': [
    { date: '2023-06-07 11:15', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-11 10:45', area: 'Atención al Cliente', user: 'María González', content: 'Orden derivada a Comercial: Caso comercial especial' },
    { date: '2023-06-11 14:00', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Recepción de derivación: Se analiza caso especial del cliente' },
    { date: '2023-06-12 15:45', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Respuesta comercial: Aprobado con condiciones - Paquete premium con 15% de descuento por 6 meses' }
  ],
  'ORD-001254': [
    { date: '2023-06-06 13:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-10 09:40', area: 'Atención al Cliente', user: 'María González', content: 'Orden derivada a Comercial: Requiere autorización especial' },
    { date: '2023-06-10 11:00', area: 'Comercial', user: 'Carlos Rodríguez', content: 'Recepción de derivación: Se solicita autorización para migración de servicio corporativo' }
  ]
};

// Datos de ejemplo para las órdenes canceladas
const cancelledOrdersData = {
  'ORD-001260': {
    customer: 'Juan Pérez',
    address: 'Av. Principal 123, Lima',
    phone: '987654321',
    serviceType: 'Instalación de Internet',
    ofscDate: '2023-06-10',
    priority: 'Alta',
    status: 'Cancelada',
    cancellationDate: '2023-06-14',
    cancelledBy: 'María González',
    cancellationReason: 'Cliente desistió del servicio',
    cancellationComments: 'El cliente indicó que ya no está interesado en el servicio por motivos personales.'
  },
  'ORD-001261': {
    customer: 'María López',
    address: 'Jr. Secundaria 456, Cusco',
    phone: '987654322',
    serviceType: 'Instalación de TV',
    ofscDate: '2023-06-09',
    priority: 'Media',
    status: 'Cancelada',
    cancellationDate: '2023-06-13',
    cancelledBy: 'Carlos Mendoza',
    cancellationReason: 'Instalación no viable',
    cancellationComments: 'No se pudo realizar la instalación debido a problemas estructurales en el edificio.'
  },
  'ORD-001262': {
    customer: 'Carlos Mendoza',
    address: 'Av. Central 789, Arequipa',
    phone: '987654323',
    serviceType: 'Reparación de línea',
    ofscDate: '2023-06-08',
    priority: 'Baja',
    status: 'Cancelada',
    cancellationDate: '2023-06-12',
    cancelledBy: 'María González',
    cancellationReason: 'Sin cobertura en la zona',
    cancellationComments: 'La dirección del cliente se encuentra fuera del área de cobertura.'
  },
  'ORD-001263': {
    customer: 'Ana García',
    address: 'Calle Las Flores 101, Trujillo',
    phone: '987654324',
    serviceType: 'Cambio de equipo',
    ofscDate: '2023-06-07',
    priority: 'Alta',
    status: 'Cancelada',
    cancellationDate: '2023-06-11',
    cancelledBy: 'Pedro Rodríguez',
    cancellationReason: 'Problemas técnicos en la instalación',
    cancellationComments: 'Se detectaron problemas técnicos que impiden la instalación del nuevo equipo.'
  },
  'ORD-001264': {
    customer: 'Luis Fernández',
    address: 'Pasaje Los Pinos 202, Piura',
    phone: '987654325',
    serviceType: 'Migración de servicio',
    ofscDate: '2023-06-06',
    priority: 'Media',
    status: 'Cancelada',
    cancellationDate: '2023-06-10',
    cancelledBy: 'María González',
    cancellationReason: 'Rechazo comercial',
    cancellationComments: 'El cliente rechazó las condiciones comerciales ofrecidas.'
  }
};

// Datos de trazabilidad para órdenes canceladas
const cancelledOrderTimelineData = {
  'ORD-001260': [
    { date: '2023-06-10 10:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-12 14:15', area: 'Atención al Cliente', user: 'María González', content: 'Intento de contacto con el cliente' },
    { date: '2023-06-13 11:20', area: 'Atención al Cliente', user: 'María González', content: 'Cliente indica que ya no está interesado en el servicio' },
    { date: '2023-06-14 09:45', area: 'Atención al Cliente', user: 'María González', content: 'Orden cancelada: Cliente desistió del servicio' }
  ],
  'ORD-001261': [
    { date: '2023-06-09 09:15', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-10 14:20', area: 'Contrata', user: 'Carlos Mendoza', content: 'Visita técnica para evaluación' },
    { date: '2023-06-13 10:30', area: 'Contrata', user: 'Carlos Mendoza', content: 'Orden cancelada: Instalación no viable por problemas estructurales' }
  ],
  'ORD-001262': [
    { date: '2023-06-08 14:30', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-10 10:15', area: 'Atención al Cliente', user: 'María González', content: 'Verificación de cobertura' },
    { date: '2023-06-12 09:20', area: 'Atención al Cliente', user: 'María González', content: 'Orden cancelada: Sin cobertura en la zona' }
  ],
  'ORD-001263': [
    { date: '2023-06-07 16:45', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-09 11:20', area: 'Contrata', user: 'Pedro Rodríguez', content: 'Intento de cambio de equipo' },
    { date: '2023-06-11 14:00', area: 'Contrata', user: 'Pedro Rodríguez', content: 'Orden cancelada: Problemas técnicos en la instalación' }
  ],
  'ORD-001264': [
    { date: '2023-06-06 13:20', area: 'Sistema', user: 'Sistema', content: 'Orden ingresada al sistema' },
    { date: '2023-06-08 10:45', area: 'Atención al Cliente', user: 'María González', content: 'Negociación comercial con el cliente' },
    { date: '2023-06-10 15:30', area: 'Atención al Cliente', user: 'María González', content: 'Orden cancelada: Rechazo comercial' }
  ]
};

// Datos de intentos de llamada por orden
const callAttemptsData = {
'ORD-001234': [
{ date: '2023-06-15 10:30', result: 'No contestó', comments: 'Llamada sin respuesta' },
{ date: '2023-06-14 15:45', result: 'Número no disponible', comments: 'Mensaje de número no disponible' },
{ date: '2023-06-13 09:20', result: 'Cliente no disponible', comments: 'Cliente indicó que llamará después' }
],
'ORD-001235': [
{ date: '2023-06-14 15:30', result: 'Contactado', comments: 'Cliente solicita reprogramación' },
{ date: '2023-06-13 11:20', result: 'No contestó', comments: 'Llamada sin respuesta' }
],
'ORD-001236': [
{ date: '2023-06-12 10:15', result: 'Contactado', comments: 'Cliente necesita confirmar dirección' }
],
'ORD-001237': [
{ date: '2023-06-14 11:30', result: 'No contestó', comments: 'Llamada sin respuesta' },
{ date: '2023-06-13 09:10', result: 'Número no disponible', comments: 'Mensaje de número no disponible' },
{ date: '2023-06-12 14:20', result: 'Cliente no disponible', comments: 'Cliente ocupado' },
{ date: '2023-06-11 16:45', result: 'No contestó', comments: 'Llamada sin respuesta' }
],
'ORD-001238': [
{ date: '2023-06-13 10:45', result: 'No contestó', comments: 'Llamada sin respuesta' },
{ date: '2023-06-12 14:30', result: 'Contactado', comments: 'Cliente requiere negociación' }
]
};

// Función para cambiar de página
function changePage(page) {
// Ocultar todas las páginas
document.querySelectorAll('.page-content').forEach(p => {
p.style.display = 'none';
});

console.log(document.getElementById(`${page}-page`))

// Mostrar la página seleccionada
document.getElementById(`${page}-page`).style.display = 'block';

// Actualizar el menú activo
document.querySelectorAll('.menu-item').forEach(item => {
item.classList.remove('active');
});
console.log(document.querySelector(`.menu-item[data-page="${page}"]`))
document.querySelector(`.menu-item[data-page="${page}"]`).classList.add('active');

// Actualizar la página actual
currentPage = page;

// Actualizar el título y contenido según la página
updatePageContent(page);

// Verificar alertas específicas para cada página
if (page === 'confirmados') {
checkConfirmedOrdersAlerts();
} else if (page === 'cierre') {
checkCierreOrdersAlerts();
} else if (page === 'finalizado') {
// Ordenar las órdenes por fecha de finalización
const tableBody = document.getElementById('finalizadoTableBody');
const rows = Array.from(tableBody.querySelectorAll('.order-row'));

// Ordenar las filas por fecha de finalización (más reciente primero)
rows.sort((a, b) => {
const dateA = new Date(a.getAttribute('data-completion-date'));
const dateB = new Date(b.getAttribute('data-completion-date'));
return dateB - dateA; // Orden descendente
});

// Reinsertar las filas en el orden correcto
rows.forEach(row => {
tableBody.appendChild(row);
});
} else if (page === 'derivados') {
    checkDerivedOrdersAlerts();
} else if (page === 'cancelados') {
    checkCancelledOrdersAlerts();
}
}

// Función para actualizar el contenido de la página
function updatePageContent(page) {
const titles = {
'tcp': 'Bandeja TCP - Trabajo en Curso',
'backlog': 'Bandeja Backlog - Órdenes Pendientes',
'confirmados': 'Bandeja Confirmados - Órdenes Agendadas',
'cierre': 'Bandeja Cierre Asegurado - Validación de Instalaciones',
'finalizado': 'Bandeja Finalizado - Historial de Órdenes',
'derivados': 'Bandeja Derivados - Órdenes a Comercial',
'cancelados': 'Bandeja Cancelados - Órdenes Canceladas'
};

const alertTexts = {
'tcp': '<strong>5 órdenes vencen hoy</strong> | <strong>3 vencen mañana</strong>. Prioriza su atención.',
'backlog': '<strong>5 órdenes vencen hoy</strong> | <strong>3 vencen mañana</strong>. Prioriza su atención.',
'confirmados': '<strong>12 órdenes confirmadas hoy</strong>. Realiza seguimiento de las instalaciones.',
'cierre': '<strong>5 órdenes pendientes de validación</strong>. Prioriza su atención.',
'finalizado': '<strong>25 órdenes finalizadas esta semana</strong>. Revisa el reporte de satisfacción.',
'derivados': '<strong>6 órdenes derivadas a comercial</strong>. Realiza seguimiento.',
'cancelados': '<strong>4 órdenes canceladas esta semana</strong>. Revisa las causas.'
};

const stats = {
'tcp': [
{ icon: 'fas fa-clipboard-list', value: '23', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-exclamation-circle', value: '8', label: 'Órdenes críticas', color: 'critical' },
{ icon: 'fas fa-tasks', value: '15', label: 'En gestión', color: 'processing' }
],
'backlog': [
{ icon: 'fas fa-clipboard-list', value: '18', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-exclamation-circle', value: '8', label: 'Órdenes críticas', color: 'critical' },
{ icon: 'fas fa-phone-alt', value: '12', label: 'Pendientes de contacto', color: 'processing' }
],
'confirmados': [
{ icon: 'fas fa-clipboard-list', value: '32', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-calendar-check', value: '15', label: 'Para hoy', color: 'critical' },
{ icon: 'fas fa-clock', value: '10', label: 'Para mañana', color: 'processing' }
],
'cierre': [
{ icon: 'fas fa-clipboard-list', value: '28', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-exclamation-circle', value: '5', label: 'Por validar', color: 'critical' },
{ icon: 'fas fa-check-circle', value: '18', label: 'Validadas', color: 'processing' }
],
'finalizado': [
{ icon: 'fas fa-clipboard-list', value: '45', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-smile', value: '38', label: 'Satisfactorias', color: 'completed' },
{ icon: 'fas fa-meh', value: '7', label: 'Con observaciones', color: 'critical' }
],
'derivados': [
{ icon: 'fas fa-clipboard-list', value: '12', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-share-alt', value: '8', label: 'En comercial', color: 'critical' },
{ icon: 'fas fa-reply', value: '4', label: 'Retornadas', color: 'processing' }
],
'cancelados': [
{ icon: 'fas fa-clipboard-list', value: '15', label: 'Total órdenes', color: 'total' },
{ icon: 'fas fa-times-circle', value: '10', label: 'Por cliente', color: 'critical' },
{ icon: 'fas fa-ban', value: '5', label: 'Por técnico', color: 'processing' }
]
};

// Actualizar título
document.getElementById('pageTitle').textContent = titles[page];

// Actualizar texto de alerta
document.getElementById('alertText').innerHTML = alertTexts[page];

// Cambiar el texto del botón según la página
const criticalOrdersBtn = document.getElementById('criticalOrdersBtn');
if (page === 'cierre') {
criticalOrdersBtn.textContent = 'Ver órdenes pendientes';
} else if (page === 'confirmados') {
criticalOrdersBtn.textContent = 'Ver órdenes confirmadas';
} else if (page === 'finalizado') {
criticalOrdersBtn.textContent = 'Ver órdenes finalizadas';
} else if (page === 'derivados') {
criticalOrdersBtn.textContent = 'Ver órdenes derivadas';
} else if (page === 'cancelados') {
criticalOrdersBtn.textContent = 'Ver órdenes canceladas';
} else {
criticalOrdersBtn.textContent = 'Ver órdenes críticas';
}

// Actualizar estadísticas
const statsContainer = document.getElementById('statsContainer');
statsContainer.innerHTML = '';

stats[page].forEach(stat => {
const statCard = document.createElement('div');
statCard.className = 'stat-card';
statCard.innerHTML = `
<div class="stat-icon ${stat.color}">
<i class="${stat.icon}"></i>
</div>
<div class="stat-content">
<h3>${stat.value}</h3>
<p>${stat.label}</p>
</div>
`;
statsContainer.appendChild(statCard);
});
}

// Función para verificar alertas en la bandeja de confirmados
function checkConfirmedOrdersAlerts() {
const now = new Date();
const today = now.toDateString();
const currentHour = now.getHours();

let outOfScheduleCount = 0;
let rescheduleCount = 0;
let failedInstallCount = 0;

// Contar órdenes fuera de horario
document.querySelectorAll('#confirmadosTableBody .order-row').forEach(row => {
const status = row.getAttribute('data-status');
const schedule = row.getAttribute('data-schedule');

if (schedule) {
const scheduleDate = new Date(schedule);

// Verificar si es hoy y está fuera del horario laboral (8:00 - 18:00)
if (scheduleDate.toDateString() === today && status === 'pending') {
const scheduleHour = scheduleDate.getHours();

if (scheduleHour < 8 || scheduleHour > 18) {
outOfScheduleCount++;
}

// Verificar si la hora actual es posterior a la hora programada
if (currentHour > scheduleHour) {
outOfScheduleCount++;
}
}
}

// Contar solicitudes de reprogramación
if (status === 'reschedule-requested') {
rescheduleCount++;
}

// Contar instalaciones fallidas
if (status === 'failed') {
failedInstallCount++;
}
});

// Mostrar alertas si hay casos
if (outOfScheduleCount > 0) {
document.getElementById('outOfScheduleAlert').style.display = 'flex';
document.getElementById('outOfScheduleCount').textContent = outOfScheduleCount;
} else {
document.getElementById('outOfScheduleAlert').style.display = 'none';
}

if (rescheduleCount > 0) {
document.getElementById('rescheduleAlert').style.display = 'flex';
document.getElementById('rescheduleCount').textContent = rescheduleCount;
} else {
document.getElementById('rescheduleAlert').style.display = 'none';
}

if (failedInstallCount > 0) {
document.getElementById('failedInstallAlert').style.display = 'flex';
document.getElementById('failedInstallCount').textContent = failedInstallCount;
} else {
document.getElementById('failedInstallAlert').style.display = 'none';
}
}

// Función para verificar alertas en la bandeja de cierre
function checkCierreOrdersAlerts() {
let pendingValidationCount = 0;

// Contar órdenes pendientes de validación
document.querySelectorAll('#cierreTableBody .order-row').forEach(row => {
const status = row.getAttribute('data-status');

if (status === 'pending') {
pendingValidationCount++;
}
});

// Mostrar alerta si hay casos
if (pendingValidationCount > 0) {
document.getElementById('pendingValidationAlert').style.display = 'flex';
document.getElementById('pendingValidationCount').textContent = pendingValidationCount;
} else {
document.getElementById('pendingValidationAlert').style.display = 'none';
}
}

// Función para mostrar detalle de orden
function showOrderDetail(orderId, page) {
currentOrderId = orderId;
currentPage = page;

// Obtener los datos según la página
let ordersData;
if (page === 'tcp') {
ordersData = tcpOrdersData;
} else if (page === 'backlog') {
ordersData = backlogOrdersData;
} else {
return; // No implementado para otras páginas
}

const order = ordersData[orderId];

if (order) {
document.getElementById('detailOrderId').textContent = orderId;
document.getElementById('detailCustomer').textContent = order.customer;
document.getElementById('detailAddress').textContent = order.address;
document.getElementById('detailPhone').textContent = order.phone || '-';
document.getElementById('detailServiceType').textContent = order.serviceType;
document.getElementById('detailOFSCDate').textContent = order.ofscDate;
document.getElementById('detailPriority').textContent = order.priority;
document.getElementById('detailStatus').textContent = order.status;

// Mostrar/ocultar respuesta comercial según corresponda
if (order.commercialResponse && order.commercialResponse !== 'N/A') {
document.getElementById('detailCommercialResponse').textContent = order.commercialResponse;
document.getElementById('commercialResponseRow').style.display = 'flex';
} else {
document.getElementById('commercialResponseRow').style.display = 'none';
}

// Verificar si la orden está próxima a vencer
checkOrderExpiration(order.ofscDate);

// Cargar trazabilidad
loadOrderTimeline(orderId);

// Mostrar/ocultar pestaña de intentos según la página
if (page === 'backlog') {
document.getElementById('attemptsTab').style.display = 'block';
// Cargar intentos de llamada
loadCallAttempts(orderId);
} else {
document.getElementById('attemptsTab').style.display = 'none';
}

// Mostrar/ocultar acciones según la página
if (page === 'tcp') {
document.getElementById('tcpActions').style.display = 'block';
document.getElementById('backlogActions').style.display = 'none';
} else {
document.getElementById('tcpActions').style.display = 'none';
document.getElementById('backlogActions').style.display = 'block';
}

document.getElementById('orderDetailModal').style.display = 'flex';
}
}

// Función para ver detalles de órdenes finalizadas
function viewFinalizedOrderDetail(orderId) {
currentOrderId = orderId;
const order = finalizedOrdersData[orderId];

if (order) {
document.getElementById('finalizedDetailOrderId').textContent = orderId;
document.getElementById('finalizedDetailCustomer').textContent = order.customer;
document.getElementById('finalizedDetailAddress').textContent = order.address;
document.getElementById('finalizedDetailPhone').textContent = order.phone;
document.getElementById('finalizedDetailServiceType').textContent = order.serviceType;
document.getElementById('finalizedDetailTechnician').textContent = order.technician;
document.getElementById('finalizedDetailCompletionDate').textContent = order.completionDate;
document.getElementById('finalizedDetailStatus').textContent = order.status;
document.getElementById('finalizedDetailRating').textContent = order.rating;

// Cargar datos de validación
document.getElementById('finalizedInstallCorrect').textContent = order.installCorrect;
document.getElementById('finalizedExplanation').textContent = order.explanation;
document.getElementById('finalizedTechnicianRating').textContent = order.technicianRating;
document.getElementById('finalizedRecommend').textContent = order.recommend;
document.getElementById('finalizedValidationComments').textContent = order.comments || 'Sin comentarios';

// Cargar trazabilidad
loadFinalizedOrderTimeline(orderId);

document.getElementById('finalizedOrderDetailModal').style.display = 'flex';
}
}

// Función para cargar la trazabilidad de la orden finalizada
function loadFinalizedOrderTimeline(orderId) {
const timeline = document.getElementById('finalizedOrderTimeline');
timeline.innerHTML = '';

if (orderTimelineData[orderId]) {
orderTimelineData[orderId].forEach(item => {
const timelineItem = document.createElement('div');
timelineItem.className = 'timeline-item';
timelineItem.innerHTML = `
<div class="timeline-date">${item.date}</div>
<div class="timeline-area">${item.area}</div>
<div class="timeline-user">Usuario: ${item.user}</div>
<div class="timeline-content">${item.content}</div>
`;
timeline.appendChild(timelineItem);
});
}
}

// Función para cambiar pestaña en detalle de órdenes finalizadas
function switchFinalizedTab(tabName) {
// Ocultar todas las pestañas
const tabs = document.querySelectorAll('#finalizedOrderDetailModal .detail-tab');
tabs.forEach(tab => tab.classList.remove('active'));

const contents = document.querySelectorAll('#finalizedOrderDetailModal .detail-content');
contents.forEach(content => content.classList.remove('active'));

// Mostrar la pestaña seleccionada
let tabIndex = 0;
if (tabName === 'general') tabIndex = 0;
else if (tabName === 'validation') tabIndex = 1;
else if (tabName === 'history') tabIndex = 2;

document.querySelectorAll('#finalizedOrderDetailModal .detail-tab')[tabIndex].classList.add('active');
document.getElementById(`finalized-${tabName}-tab`).classList.add('active');
}

// Función para verificar si una orden está próxima a vencer
function checkOrderExpiration(ofscDate) {
const today = new Date();
const tomorrow = new Date(today);
tomorrow.setDate(tomorrow.getDate() + 1);

const orderDate = new Date(ofscDate);

if (orderDate.toDateString() === today.toDateString()) {
document.getElementById('expirationAlert').style.display = 'flex';
document.getElementById('expirationText').textContent = 'hoy';
} else if (orderDate.toDateString() === tomorrow.toDateString()) {
document.getElementById('expirationAlert').style.display = 'flex';
document.getElementById('expirationText').textContent = 'mañana';
} else {
document.getElementById('expirationAlert').style.display = 'none';
}
}

// Función para cargar la trazabilidad de la orden
function loadOrderTimeline(orderId) {
const timeline = document.getElementById('orderTimeline');
timeline.innerHTML = '';

if (orderTimelineData[orderId]) {
orderTimelineData[orderId].forEach(item => {
const timelineItem = document.createElement('div');
timelineItem.className = 'timeline-item';
timelineItem.innerHTML = `
<div class="timeline-date">${item.date}</div>
<div class="timeline-area">${item.area}</div>
<div class="timeline-user">Usuario: ${item.user}</div>
<div class="timeline-content">${item.content}</div>
`;
timeline.appendChild(timelineItem);
});
}
}

// Función para cargar los intentos de llamada de la orden
function loadCallAttempts(orderId) {
const callAttemptsList = document.getElementById('callAttemptsList');
callAttemptsList.innerHTML = '';

if (callAttemptsData[orderId]) {
callAttemptsData[orderId].forEach((attempt, index) => {
const attemptItem = document.createElement('div');
attemptItem.className = 'call-attempt-item';
attemptItem.innerHTML = `
<div class="call-attempt-info">
<div class="call-attempt-date">${attempt.date}</div>
<div class="call-attempt-result">${attempt.result}</div>
${attempt.comments ? `<div class="call-attempt-comments">${attempt.comments}</div>` : ''}
</div>
<div class="call-attempt-actions">
<button class="call-attempt-action" title="Ver detalles" onclick="viewCallAttempt('${orderId}', ${index})">
<i class="fas fa-eye"></i>
</button>
<button class="call-attempt-action" title="Editar" onclick="editCallAttempt('${orderId}', ${index})">
<i class="fas fa-edit"></i>
</button>
</div>
`;
callAttemptsList.appendChild(attemptItem);
});
}
}

// Función para agregar un evento a la trazabilidad
function addTimelineEvent(orderId, area, user, content) {
if (!orderTimelineData[orderId]) {
orderTimelineData[orderId] = [];
}

const now = new Date();
const dateStr = now.toLocaleDateString('es-ES');
const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

orderTimelineData[orderId].push({
date: `${dateStr} ${timeStr}`,
area: area,
user: user,
content: content
});
}

// Función para agregar un intento de llamada
function addCallAttempt(orderId, date, result, comments) {
if (!callAttemptsData[orderId]) {
callAttemptsData[orderId] = [];
}

callAttemptsData[orderId].push({
date: date,
result: result,
comments: comments
});
}

// Función para actualizar un intento de llamada existente
function updateCallAttempt(orderId, index, date, result, comments) {
if (callAttemptsData[orderId] && callAttemptsData[orderId][index]) {
callAttemptsData[orderId][index] = {
date: date,
result: result,
comments: comments
};
}
}

// Función para mostrar modal de registrar intento de llamada
function registerCallAttempt(orderId) {
currentOrderId = orderId;
document.getElementById('callAttemptOrderId').textContent = orderId;
document.getElementById('callAttemptModalTitle').innerHTML = 'Registrar Intento de Llamada: <span id="callAttemptOrderId"></span>';
document.getElementById('saveCallAttemptBtn').textContent = 'Guardar';
editingAttemptIndex = null;

// Establecer fecha y hora actual por defecto
const now = new Date();
const year = now.getFullYear();
const month = String(now.getMonth() + 1).padStart(2, '0');
const day = String(now.getDate()).padStart(2, '0');
const hours = String(now.getHours()).padStart(2, '0');
const minutes = String(now.getMinutes()).padStart(2, '0');

document.getElementById('callDate').value = `${year}-${month}-${day}T${hours}:${minutes}`;
document.getElementById('callResult').value = '';
document.getElementById('callComments').value = '';

document.getElementById('callAttemptModal').style.display = 'flex';
}

// Función para editar un intento de llamada existente
function editCallAttempt(orderId, index) {
currentOrderId = orderId;
editingAttemptIndex = index;

document.getElementById('callAttemptModalTitle').innerHTML = 'Editar Intento de Llamada: <span id="callAttemptOrderId"></span>';
document.getElementById('saveCallAttemptBtn').textContent = 'Actualizar';
document.getElementById('callAttemptOrderId').textContent = orderId;

// Cargar datos del intento de llamada
if (callAttemptsData[orderId] && callAttemptsData[orderId][index]) {
const attempt = callAttemptsData[orderId][index];

// Convertir la fecha al formato datetime-local
const dateObj = new Date(attempt.date);
const year = dateObj.getFullYear();
const month = String(dateObj.getMonth() + 1).padStart(2, '0');
const day = String(dateObj.getDate()).padStart(2, '0');
const hours = String(dateObj.getHours()).padStart(2, '0');
const minutes = String(dateObj.getMinutes()).padStart(2, '0');

document.getElementById('callDate').value = `${year}-${month}-${day}T${hours}:${minutes}`;

// Establecer el resultado
const resultSelect = document.getElementById('callResult');
for (let i = 0; i < resultSelect.options.length; i++) {
if (resultSelect.options[i].text === attempt.result) {
resultSelect.selectedIndex = i;
break;
}
}

document.getElementById('callComments').value = attempt.comments || '';
}

document.getElementById('callAttemptModal').style.display = 'flex';
}

// Función para ver detalles de un intento de llamada
function viewCallAttempt(orderId, index) {
if (callAttemptsData[orderId] && callAttemptsData[orderId][index]) {
const attempt = callAttemptsData[orderId][index];

document.getElementById('viewCallDate').textContent = attempt.date;
document.getElementById('viewCallResult').textContent = attempt.result;
document.getElementById('viewCallComments').textContent = attempt.comments || 'Sin comentarios';

document.getElementById('viewCallAttemptModal').style.display = 'flex';
}
}

// Función para guardar intento de llamada
function saveCallAttempt() {
const orderId = document.getElementById('callAttemptOrderId').textContent;
const date = document.getElementById('callDate').value;
const result = document.getElementById('callResult').value;
const comments = document.getElementById('callComments').value;

if (!date || !result) {
alert('Por favor complete los campos obligatorios');
return;
}

// Formatear fecha para mostrar
const dateObj = new Date(date);
const dateStr = dateObj.toLocaleDateString('es-ES');
const timeStr = dateObj.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
const formattedDate = `${dateStr} ${timeStr}`;

if (editingAttemptIndex !== null) {
// Actualizar intento existente
updateCallAttempt(orderId, editingAttemptIndex, formattedDate, result, comments);

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', `Actualización de intento de llamada: ${result}${comments ? ' - ' + comments : ''}`);

alert('Intento de llamada actualizado correctamente.');
} else {
// Agregar nuevo intento de llamada
addCallAttempt(orderId, formattedDate, result, comments);

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', `Registro de intento de llamada: ${result}${comments ? ' - ' + comments : ''}`);

// Actualizar contador de intentos en la tabla
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
const attemptsBadge = row.querySelector('.attempts-badge');
if (attemptsBadge) {
const currentAttempts = callAttemptsData[orderId].length;
attemptsBadge.textContent = `${currentAttempts} intento${currentAttempts !== 1 ? 's' : ''}`;
}
}
});

alert('Intento de llamada registrado correctamente.');
}

closeModal('callAttemptModal');

// Si el modal de detalle está abierto, actualizar la lista de intentos
if (document.getElementById('orderDetailModal').style.display === 'flex') {
loadCallAttempts(orderId);
}

// Resetear formulario
document.getElementById('callAttemptForm').reset();
editingAttemptIndex = null;
}

// Función para mostrar modal de enviar speech por WhatsApp
function showWhatsAppModal(orderId) {
currentOrderId = orderId;
const ordersData = currentPage === 'tcp' ? tcpOrdersData : backlogOrdersData;
const order = ordersData[orderId];

if (order) {
document.getElementById('whatsappOrderId').textContent = orderId;
document.getElementById('whatsappCustomer').textContent = order.customer;
document.getElementById('whatsappOrderNumber').textContent = orderId;
document.getElementById('whatsappOrderDate').textContent = order.ofscDate;
document.getElementById('whatsappPhone').value = order.phone;

document.getElementById('whatsappModal').style.display = 'flex';
}
}

// Función para enviar mensaje de WhatsApp
function sendWhatsAppMessage() {
const orderId = document.getElementById('whatsappOrderId').textContent;
const phone = document.getElementById('whatsappPhone').value;

if (!phone) {
alert('Por favor ingrese un número de teléfono');
return;
}

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', `Envío de speech por WhatsApp al número ${phone}`);

// Abrir WhatsApp Web con el mensaje predefinido
const message = document.getElementById('whatsappSpeech').innerText;
const encodedMessage = encodeURIComponent(message);
const whatsappUrl = `https://wa.me/${phone.replace(/\D/g, '')}?text=${encodedMessage}`;

window.open(whatsappUrl, '_blank');

alert('Mensaje de WhatsApp enviado correctamente.');

closeModal('whatsappModal');
}

// Función para mostrar modal de validar información
function showValidateModal(orderId) {
currentOrderId = orderId;
document.getElementById('validateOrderId').textContent = orderId;

document.getElementById('validateModal').style.display = 'flex';
}

// Función para guardar validación
function saveValidation() {
const orderId = document.getElementById('validateOrderId').textContent;
const nameValidation = document.querySelector('input[name="nameValidation"]:checked').value;
const addressValidation = document.querySelector('input[name="addressValidation"]:checked').value;
const phoneValidation = document.querySelector('input[name="phoneValidation"]:checked').value;
const serviceValidation = document.querySelector('input[name="serviceValidation"]:checked').value;
const interestValidation = document.querySelector('input[name="interestValidation"]:checked').value;
const comments = document.getElementById('validationComments').value;

// Crear mensaje de validación
let validationMessage = 'Validación de información completada: ';
validationMessage += `Nombre: ${nameValidation === 'correct' ? 'Correcto' : 'Incorrecto'}, `;
validationMessage += `Dirección: ${addressValidation === 'correct' ? 'Correcta' : 'Incorrecta'}, `;
validationMessage += `Teléfono: ${phoneValidation === 'correct' ? 'Correcto' : 'Incorrecto'}, `;
validationMessage += `Servicio: ${serviceValidation === 'correct' ? 'Correcto' : 'Incorrecto'}, `;
validationMessage += `Interés: ${interestValidation === 'yes' ? 'Sí' : interestValidation === 'no' ? 'No' : 'Tal vez'}`;
if (comments) {
validationMessage += ` - ${comments}`;
}

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', validationMessage);

alert('Validación de información guardada correctamente.');

closeModal('validateModal');

// Resetear formulario
document.getElementById('validationComments').value = '';
document.querySelectorAll('input[type="radio"]').forEach(radio => {
if (radio.value === 'correct' || radio.value === 'yes') {
radio.checked = true;
} else {
radio.checked = false;
}
});
}

// Función para mostrar modal de agendar
function showScheduleModal(orderId) {
currentOrderId = orderId;
document.getElementById('scheduleOrderId').textContent = orderId;
document.getElementById('scheduleModal').style.display = 'flex';
}

// Función para enviar a backlog (reprogramar)
function sendToBacklog(orderId) {
currentOrderId = orderId;
document.getElementById('backlogOrderId').textContent = orderId;
document.getElementById('backlogModal').style.display = 'flex';
}

// Función para enviar a derivar
function sendToDerive(orderId) {
currentOrderId = orderId;
const ordersData = currentPage === 'tcp' ? tcpOrdersData : backlogOrdersData;
const order = ordersData[orderId];

if (order) {
document.getElementById('deriveOrderId').textContent = orderId;
document.getElementById('deriveCustomer').textContent = order.customer;
document.getElementById('derivePhone').textContent = order.phone;
document.getElementById('deriveAddress').textContent = order.address;
document.getElementById('deriveServiceType').textContent = order.serviceType;

document.getElementById('deriveModal').style.display = 'flex';
}
}

// Función para enviar a cancelados
function sendToCancelled(orderId) {
currentOrderId = orderId;
document.getElementById('cancelledOrderId').textContent = orderId;
document.getElementById('cancelledModal').style.display = 'flex';
}

// Función para cerrar modal
function closeModal(modalId) {
document.getElementById(modalId).style.display = 'none';
}

// Función para cambiar pestaña en detalle
function switchTab(tabName) {
// Ocultar todas las pestañas
const tabs = document.querySelectorAll('.detail-tab');
tabs.forEach(tab => tab.classList.remove('active'));

const contents = document.querySelectorAll('.detail-content');
contents.forEach(content => content.classList.remove('active'));

// Mostrar la pestaña seleccionada
let tabIndex = 0;
if (tabName === 'general') tabIndex = 0;
else if (tabName === 'actions') tabIndex = 1;
else if (tabName === 'attempts') tabIndex = 2;
else if (tabName === 'history') tabIndex = 3;

document.querySelectorAll('.detail-tab')[tabIndex].classList.add('active');
document.getElementById(`${tabName}-tab`).classList.add('active');
}

// Función para manejar las acciones principales
function handleAction(action) {
if (!currentOrderId) return;

switch(action) {
case 'call':
registerCallAttempt(currentOrderId);
break;

case 'whatsapp':
showWhatsAppModal(currentOrderId);
break;

case 'validate':
showValidateModal(currentOrderId);
break;

case 'schedule':
showScheduleModal(currentOrderId);
break;

case 'backlog':
sendToBacklog(currentOrderId);
break;

case 'derive':
sendToDerive(currentOrderId);
break;

case 'cancel':
sendToCancelled(currentOrderId);
break;
}
}

// Función para guardar agendamiento
function saveSchedule() {
const orderId = document.getElementById('scheduleOrderId').textContent;
const altPhone = document.getElementById('altPhone').value;
const preferredTime = document.getElementById('preferredTime').value;
const scheduleDate = document.getElementById('scheduleDate').value;
const comments = document.getElementById('technicianComments').value;

if (!preferredTime || !scheduleDate) {
alert('Por favor complete los campos obligatorios');
return;
}

// Crear mensaje de agendamiento
let scheduleMessage = `Orden agendada para el ${scheduleDate} en horario ${preferredTime}`;
if (altPhone) {
scheduleMessage += ` - Teléfono alternativo: ${altPhone}`;
}
if (comments) {
scheduleMessage += ` - Comentarios para técnico: ${comments}`;
}

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', scheduleMessage);

// Simular envío a OFSC y actualización en tiempo real
alert(`Orden ${orderId} agendada correctamente para el ${scheduleDate} en horario ${preferredTime}. La orden desaparecerá de la lista de otras agendadoras.`);

// Eliminar la orden de la tabla (simulación de actualización en tiempo real)
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
row.remove();
}
});

closeModal('scheduleModal');
closeModal('orderDetailModal');

// Resetear formulario
document.getElementById('scheduleForm').reset();
}

// Función para confirmar envío a backlog (reprogramar)
function sendToBacklogConfirm() {
const orderId = document.getElementById('backlogOrderId').textContent;
const reason = document.getElementById('backlogReason').value;
const comment = document.getElementById('backlogComment').value;
const newDate = document.getElementById('newDate').value;

if (!reason || !comment) {
alert('Por favor complete todos los campos');
return;
}

// Crear mensaje de reprogramación
let backlogMessage = `Reprogramada: ${reason} - ${comment}`;
if (newDate) {
backlogMessage += ` - Nueva fecha tentativa: ${newDate}`;
}

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', backlogMessage);

alert(`Orden ${orderId} reprogramada correctamente.`);

// Eliminar la orden de la tabla
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
row.remove();
}
});

closeModal('backlogModal');
closeModal('orderDetailModal');

// Resetear formulario
document.getElementById('backlogForm').reset();
}

// Función para confirmar envío a derivar
function sendToDeriveConfirm() {
const orderId = document.getElementById('deriveOrderId').textContent;
const reason = document.getElementById('deriveReason').value;
const comment = document.getElementById('deriveComment').value;

if (!reason || !comment) {
alert('Por favor complete todos los campos');
return;
}

// Crear mensaje de derivación
const deriveMessage = `Derivada a Comercial: ${reason} - ${comment}`;

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Comercial', 'Carlos Rodríguez', deriveMessage);

alert(`Orden ${orderId} derivada correctamente al área de Comercial.`);

// Eliminar la orden de la tabla
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
row.remove();
}
});

closeModal('deriveModal');
closeModal('orderDetailModal');

// Resetear formulario
document.getElementById('deriveForm').reset();
}

// Función para confirmar envío a cancelados
function sendToCancelledConfirm() {
const orderId = document.getElementById('cancelledOrderId').textContent;
const reason = document.getElementById('cancelledReason').value;
const comment = document.getElementById('cancelledComment').value;

if (!reason || !comment) {
alert('Por favor complete todos los campos');
return;
}

// Crear mensaje de cancelación
const cancelledMessage = `Cancelada: ${reason} - ${comment}`;

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', cancelledMessage);

alert(`Orden ${orderId} cancelada correctamente.`);

// Eliminar la orden de la tabla
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
row.remove();
}
});

closeModal('cancelledModal');
closeModal('orderDetailModal');

// Resetear formulario
document.getElementById('cancelledForm').reset();
}

// Función para validar una instalación (Cierre Asegurado)
function validateInstallation(orderId) {
currentOrderId = orderId;
const order = cierreOrdersData[orderId];

if (order) {
document.getElementById('cierreValidationOrderId').textContent = orderId;
document.getElementById('cierreValidationCustomer').textContent = order.customer;
document.getElementById('cierreValidationAddress').textContent = order.address;
document.getElementById('cierreValidationTechnician').textContent = order.technician;
document.getElementById('cierreValidationCompletionDate').textContent = order.completionDate;

document.getElementById('cierreValidationSpeechCustomer').textContent = order.customer;
document.getElementById('cierreValidationSpeechService').textContent = order.serviceType;
document.getElementById('cierreValidationSpeechDate').textContent = order.completionDate;

// Resetear formulario
document.getElementById('cierreValidationComments').value = '';
document.getElementById('cierreValidationReason').value = '';
document.querySelectorAll('input[name^="cierre"]').forEach(radio => {
if (radio.value === 'yes' || radio.value === '5') {
radio.checked = true;
} else {
radio.checked = false;
}
});

document.getElementById('cierreValidationModal').style.display = 'flex';
}
}

// Función para ver detalles de validación (Cierre Asegurado)
function viewValidationDetails(orderId) {
const order = cierreOrdersData[orderId];

if (order && order.status === 'Validada') {
document.getElementById('viewCierreValidationOrderId').textContent = orderId;
document.getElementById('viewCierreValidationCustomer').textContent = order.customer;
document.getElementById('viewCierreValidationAddress').textContent = order.address;
document.getElementById('viewCierreValidationTechnician').textContent = order.technician;
document.getElementById('viewCierreValidationCompletionDate').textContent = order.completionDate;
document.getElementById('viewCierreValidationDate').textContent = order.validationDate;

document.getElementById('viewCierreInstallCorrect').textContent = order.installCorrect;
document.getElementById('viewCierreExplanation').textContent = order.explanation;
document.getElementById('viewCierreTechnicianRating').textContent = order.technicianRating;
document.getElementById('viewCierreRecommend').textContent = order.recommend;
document.getElementById('viewCierreValidationComments').textContent = order.comments || 'Sin comentarios';

if (order.reason) {
document.getElementById('viewCierreValidationReason').textContent = order.reason;
document.getElementById('viewCierreValidationReasonRow').style.display = 'flex';
} else {
document.getElementById('viewCierreValidationReasonRow').style.display = 'none';
}

document.getElementById('viewCierreValidationModal').style.display = 'flex';
}
}

// Función para guardar la validación (Cierre Asegurado)
function saveCierreValidation() {
const orderId = document.getElementById('cierreValidationOrderId').textContent;
const installCorrect = document.querySelector('input[name="cierreInstallCorrect"]:checked').value;
const explanation = document.querySelector('input[name="cierreExplanation"]:checked').value;
const technicianRating = document.querySelector('input[name="cierreTechnicianRating"]:checked').value;
const recommend = document.querySelector('input[name="cierreRecommend"]:checked').value;
const comments = document.getElementById('cierreValidationComments').value;
const reason = document.getElementById('cierreValidationReason').value;

// Verificar si se ha respondido la encuesta o se ha proporcionado un motivo
if (!reason && (!installCorrect || !explanation || !technicianRating || !recommend)) {
alert('Por favor complete la encuesta o proporcione un motivo si el cliente no respondió');
return;
}

// Actualizar datos de la orden
const order = cierreOrdersData[orderId];
if (order) {
order.status = 'Validada';

const now = new Date();
const dateStr = now.toLocaleDateString('es-ES');
const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

order.validationDate = `${dateStr} ${timeStr}`;
order.installCorrect = installCorrect === 'yes' ? 'Sí' : 'No';
order.explanation = explanation === 'yes' ? 'Sí' : 'No';
order.technicianRating = technicianRating;
order.recommend = recommend === 'yes' ? 'Sí' : 'No';
order.comments = comments;
order.reason = reason;

// Actualizar la tabla
const rows = document.querySelectorAll('#cierreTableBody .order-row');
rows.forEach(row => {
if (row.querySelector('.order-id').textContent === orderId) {
// Actualizar estado
const statusCell = row.querySelector('.status-badge');
statusCell.textContent = 'Validada';
statusCell.className = 'status-badge status-validated';

// Actualizar atributo
row.setAttribute('data-status', 'validated');

// Actualizar botón de acción
const actionBtn = row.querySelector('.action-btn');
actionBtn.setAttribute('onclick', `viewValidationDetails('${orderId}')`);
actionBtn.innerHTML = '<i class="fas fa-eye"></i>';
actionBtn.className = 'action-btn primary';
}
});

// Agregar evento a la trazabilidad
addTimelineEvent(orderId, 'Atención al Cliente', 'María González', `Validación de instalación completada - Calificación del técnico: ${technicianRating}/5`);

alert(`Validación de la orden ${orderId} guardada correctamente.`);

closeModal('cierreValidationModal');

// Actualizar alertas
checkCierreOrdersAlerts();
}
}

// Función para filtrar órdenes
function filterOrders(filter, page) {
const buttons = document.querySelectorAll('.filter-btn');
buttons.forEach(btn => btn.classList.remove('active'));
event.target.classList.add('active');

if (page === 'cierre') {
const rows = document.querySelectorAll('#cierreTableBody .order-row');

rows.forEach(row => {
const status = row.getAttribute('data-status');
const completionDate = row.getAttribute('data-completion-date');
const orderId = row.querySelector('.order-id').textContent;

if (filter === 'all') {
row.style.display = '';
} else if (filter === 'pending' && status === 'pending') {
row.style.display = '';
} else if (filter === 'validated' && status === 'validated') {
row.style.display = '';
} else if (filter === 'today' && completionDate === '2023-06-15') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
} else if (page === 'confirmados') {
const rows = document.querySelectorAll('#confirmadosTableBody .order-row');

rows.forEach(row => {
const status = row.getAttribute('data-status');
const orderId = row.querySelector('.order-id').textContent;

if (filter === 'all') {
row.style.display = '';
} else if (filter === 'pending' && status === 'pending') {
row.style.display = '';
} else if (filter === 'in-progress' && status === 'in-progress') {
row.style.display = '';
} else if (filter === 'reschedule-requested' && status === 'reschedule-requested') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
} else if (page === 'finalizado') {
const tableBody = document.getElementById('finalizadoTableBody');
const rows = Array.from(tableBody.querySelectorAll('.order-row'));

if (filter === 'all') {
// Mostrar todas las filas
rows.forEach(row => row.style.display = '');

// Ordenar las filas por fecha de finalización (más reciente primero)
rows.sort((a, b) => {
const dateA = new Date(a.getAttribute('data-completion-date'));
const dateB = new Date(b.getAttribute('data-completion-date'));
return dateB - dateA; // Orden descendente
});

// Reinsertar las filas en el orden correcto
rows.forEach(row => {
tableBody.appendChild(row);
});
} else if (filter === 'satisfactory') {
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'satisfactory') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
} else if (filter === 'observations') {
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'observations') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
} else if (filter === 'last-week') {
rows.forEach(row => {
const status = row.getAttribute('data-status');
const completionDate = row.getAttribute('data-completion-date');
const orderId = row.querySelector('.order-id').textContent;

// Verificar si la fecha de finalización está en la última semana
const orderDate = new Date(completionDate);
const today = new Date();
const oneWeekAgo = new Date(today);
oneWeekAgo.setDate(today.getDate() - 7);

if (orderDate >= oneWeekAgo && orderDate <= today) {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
}
} else if (page === 'derivados') {
const rows = document.querySelectorAll('#derivadosTableBody .order-row');

rows.forEach(row => {
    const status = row.getAttribute('data-status');
    const derivationDate = row.getAttribute('data-derivation-date');
    const orderId = row.querySelector('.order-id').textContent;

    if (filter === 'all') {
    row.style.display = '';
    } else if (filter === 'pending' && status === 'pending') {
    row.style.display = '';
    } else if (filter === 'responded' && status === 'responded') {
    row.style.display = '';
    } else if (filter === 'recent') {
    // Verificar si la orden es reciente (últimos 3 días)
    const orderDate = new Date(derivationDate);
    const today = new Date();
    const threeDaysAgo = new Date(today);
    threeDaysAgo.setDate(today.getDate() - 3);

    if (orderDate >= threeDaysAgo) {
        row.style.display = '';
    } else {
        row.style.display = 'none';
    }
    } else {
    row.style.display = 'none';
    }
});
} else if (page === 'cancelados') {
    const rows = document.querySelectorAll('#canceladosTableBody .order-row');

    rows.forEach(row => {
      const status = row.getAttribute('data-status');
      const cancellationDate = row.getAttribute('data-cancellation-date');
      const orderId = row.querySelector('.order-id').textContent;

      if (filter === 'all') {
        row.style.display = '';
      } else if (filter === 'client' && status === 'client') {
        row.style.display = '';
      } else if (filter === 'technical' && status === 'technical') {
        row.style.display = '';
      } else if (filter === 'last-week') {
        // Verificar si la orden es de la última semana
        const orderDate = new Date(cancellationDate);
        const today = new Date();
        const oneWeekAgo = new Date(today);
        oneWeekAgo.setDate(today.getDate() - 7);

        if (orderDate >= oneWeekAgo) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      } else {
        row.style.display = 'none';
      }
    });
} else {
const tableBody = page === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);

rows.forEach(row => {
const priority = row.getAttribute('data-priority');
const status = row.getAttribute('data-status');
const orderId = row.querySelector('.order-id').textContent;

const ordersData = page === 'tcp' ? tcpOrdersData : backlogOrdersData;
const order = ordersData[orderId];

if (filter === 'all') {
row.style.display = '';
} else if (filter === 'critical' && priority === 'high') {
row.style.display = '';
} else if (filter === 'today' && order.ofscDate === '2023-06-15') {
row.style.display = '';
} else if (filter === 'tomorrow' && order.ofscDate === '2023-06-16') {
row.style.display = '';
} else if (filter === 'no-contact' && status === 'no-contact') {
row.style.display = '';
} else if (filter === 'rescheduled' && status === 'rescheduled') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
}


}

// Función para manejar el botón de órdenes críticas/confirmadas/pendientes
document.getElementById('criticalOrdersBtn').addEventListener('click', function() {
if (currentPage === 'cierre') {
// En la página de cierre, filtrar las órdenes pendientes de validación
// Activar el botón de filtro pendientes
const filterButtons = document.querySelectorAll('#cierre-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'pending\', \'cierre\')"]').classList.add('active');

// Filtrar las órdenes pendientes
const rows = document.querySelectorAll('#cierreTableBody .order-row');
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'pending') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
} else if (currentPage === 'confirmados') {
// En la página de confirmados, filtrar las órdenes confirmadas del día actual
const today = new Date().toISOString().split('T')[0]; // Formato YYYY-MM-DD

// Activar el botón de filtro todas
const filterButtons = document.querySelectorAll('#confirmados-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'all\', \'confirmados\')"]').classList.add('active');

// Filtrar las órdenes del día actual
const rows = document.querySelectorAll('#confirmadosTableBody .order-row');
rows.forEach(row => {
const schedule = row.getAttribute('data-schedule');
if (schedule) {
const scheduleDate = schedule.split('T')[0]; // Formato YYYY-MM-DD
if (scheduleDate === today) {
row.style.display = '';
} else {
row.style.display = 'none';
}
} else {
row.style.display = 'none';
}
});
} else if (currentPage === 'finalizado') {
// En la página de finalizados, mostrar todas las órdenes con estado finalizado ordenadas por fecha
const tableBody = document.getElementById('finalizadoTableBody');
const rows = Array.from(tableBody.querySelectorAll('.order-row'));

// Filtrar solo las órdenes con estado finalizado
const finalizedRows = rows.filter(row => {
const statusBadge = row.querySelector('.status-badge');
return statusBadge && statusBadge.textContent.trim() === 'Finalizado';
});

// Ocultar todas las filas primero
rows.forEach(row => row.style.display = 'none');

// Mostrar solo las filas con estado finalizado
finalizedRows.forEach(row => row.style.display = '');

// Ordenar las filas por fecha de finalización (más reciente primero)
finalizedRows.sort((a, b) => {
const dateA = new Date(a.getAttribute('data-completion-date'));
const dateB = new Date(b.getAttribute('data-completion-date'));
return dateB - dateA; // Orden descendente (más reciente primero)
});

// Reinsertar las filas en el orden correcto
finalizedRows.forEach(row => {
tableBody.appendChild(row);
});

// Activar el botón de filtro "Todas"
const filterButtons = document.querySelectorAll('#finalizado-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'all\', \'finalizado\')"]').classList.add('active');
} else {
// En las otras páginas, filtrar las órdenes críticas
// Activar el botón de filtro crítico
const filterButtons = document.querySelectorAll('.filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));

if (currentPage === 'tcp') {
document.querySelector('.filter-btn[onclick="filterOrders(\'critical\', \'tcp\')"]').classList.add('active');
} else {
document.querySelector('.filter-btn[onclick="filterOrders(\'critical\', \'backlog\')"]').classList.add('active');
}

// Filtrar las órdenes críticas
const tableBody = currentPage === 'tcp' ? 'tcpTableBody' : 'backlogTableBody';
const rows = document.querySelectorAll(`#${tableBody} .order-row`);
rows.forEach(row => {
const priority = row.getAttribute('data-priority');
if (priority === 'high') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
}

// Scroll hasta la tabla
document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver órdenes fuera de horario
document.getElementById('viewOutOfScheduleBtn').addEventListener('click', function() {
// Activar el botón de filtro pendientes
const filterButtons = document.querySelectorAll('#confirmados-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'pending\', \'confirmados\')"]').classList.add('active');

// Filtrar las órdenes pendientes
const rows = document.querySelectorAll('#confirmadosTableBody .order-row');
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'pending') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});

// Scroll hasta la tabla
document.querySelector('#confirmados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver solicitudes de reprogramación
document.getElementById('viewRescheduleBtn').addEventListener('click', function() {
// Activar el botón de filtro de reprogramación solicitada
const filterButtons = document.querySelectorAll('#confirmados-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'reschedule-requested\', \'confirmados\')"]').classList.add('active');

// Filtrar las órdenes con reprogramación solicitada
const rows = document.querySelectorAll('#confirmadosTableBody .order-row');
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'reschedule-requested') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});

// Scroll hasta la tabla
document.querySelector('#confirmados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver instalaciones fallidas
document.getElementById('viewFailedInstallBtn').addEventListener('click', function() {
// Activar el botón de filtro todas
const filterButtons = document.querySelectorAll('#confirmados-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'all\', \'confirmados\')"]').classList.add('active');

// Filtrar las órdenes fallidas
const rows = document.querySelectorAll('#confirmadosTableBody .order-row');
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'failed') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});

// Scroll hasta la tabla
document.querySelector('#confirmados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver órdenes pendientes de validación
document.getElementById('viewPendingValidationBtn').addEventListener('click', function() {
// Activar el botón de filtro pendientes
const filterButtons = document.querySelectorAll('#cierre-page .filter-btn');
filterButtons.forEach(btn => btn.classList.remove('active'));
document.querySelector('.filter-btn[onclick="filterOrders(\'pending\', \'cierre\')"]').classList.add('active');

// Filtrar las órdenes pendientes
const rows = document.querySelectorAll('#cierreTableBody .order-row');
rows.forEach(row => {
const status = row.getAttribute('data-status');
if (status === 'pending') {
row.style.display = '';
} else {
row.style.display = 'none';
}
});

// Scroll hasta la tabla
document.querySelector('#cierre-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para verificar alertas en la bandeja de derivados
function checkDerivedOrdersAlerts() {
  let pendingResponseCount = 0;
  let newResponseCount = 0;

  // Contar órdenes pendientes de respuesta
  document.querySelectorAll('#derivadosTableBody .order-row').forEach(row => {
    const status = row.getAttribute('data-status');
    const derivationDate = row.getAttribute('data-derivation-date');

    if (status === 'pending') {
      pendingResponseCount++;
    }

    // Contar órdenes con respuesta reciente (últimos 2 días)
    if (status === 'responded') {
      const orderDate = new Date(derivationDate);
      const today = new Date();
      const twoDaysAgo = new Date(today);
      twoDaysAgo.setDate(today.getDate() - 2);

      if (orderDate >= twoDaysAgo) {
        newResponseCount++;
      }
    }
  });

  // Mostrar alertas si hay casos
  if (pendingResponseCount > 0) {
    document.getElementById('pendingResponseAlert').style.display = 'flex';
    document.getElementById('pendingResponseCount').textContent = pendingResponseCount;
  } else {
    document.getElementById('pendingResponseAlert').style.display = 'none';
  }

  if (newResponseCount > 0) {
    document.getElementById('newResponseAlert').style.display = 'flex';
    document.getElementById('newResponseCount').textContent = newResponseCount;
  } else {
    document.getElementById('newResponseAlert').style.display = 'none';
  }
}

// Función para ver detalles de órdenes derivadas
function viewDerivedOrderDetail(orderId) {
  currentOrderId = orderId;
  const order = derivedOrdersData[orderId];

  if (order) {
    // Datos generales
    document.getElementById('derivedDetailOrderId').textContent = orderId;
    document.getElementById('derivedDetailCustomer').textContent = order.customer;
    document.getElementById('derivedDetailAddress').textContent = order.address;
    document.getElementById('derivedDetailPhone').textContent = order.phone;
    document.getElementById('derivedDetailServiceType').textContent = order.serviceType;
    document.getElementById('derivedDetailOFSCDate').textContent = order.ofscDate;
    document.getElementById('derivedDetailPriority').textContent = order.priority;
    document.getElementById('derivedDetailStatus').textContent = order.status;

    // Datos de derivación
    document.getElementById('derivedDetailDerivationDate').textContent = order.derivationDate;
    document.getElementById('derivedDetailDerivationReason').textContent = order.derivationReason;
    document.getElementById('derivedDetailDerivationComments').textContent = order.derivationComments;
    document.getElementById('derivedDetailDerivationUser').textContent = order.derivationUser;

    // Datos de respuesta
    if (order.responseDate) {
      document.getElementById('responsePendingSection').style.display = 'none';
      document.getElementById('responseReceivedSection').style.display = 'block';

      document.getElementById('derivedDetailResponseDate').textContent = order.responseDate;
      document.getElementById('derivedDetailResponseUser').textContent = order.responseUser;
      document.getElementById('derivedDetailResponseResult').textContent = order.responseResult;
      document.getElementById('derivedDetailResponseComments').textContent = order.responseComments;
      document.getElementById('derivedDetailAdditionalInfo').textContent = order.additionalInfo || 'Sin información adicional';
    } else {
      document.getElementById('responsePendingSection').style.display = 'block';
      document.getElementById('responseReceivedSection').style.display = 'none';
    }

    // Cargar trazabilidad
    loadDerivedOrderTimeline(orderId);

    // Cargar acciones según estado
    loadDerivedOrderActions(orderId, order.status);

    document.getElementById('derivedOrderDetailModal').style.display = 'flex';
  }
}

// Función para cargar la trazabilidad de la orden derivada
function loadDerivedOrderTimeline(orderId) {
  const timeline = document.getElementById('derivedOrderTimeline');
  timeline.innerHTML = '';

  // Usar los datos específicos para órdenes derivadas
  const timelineData = derivedOrderTimelineData[orderId] || [];
  
  if (timelineData.length > 0) {
    timelineData.forEach(item => {
      const timelineItem = document.createElement('div');
      timelineItem.className = 'timeline-item';
      timelineItem.innerHTML = `
        <div class="timeline-date">${item.date}</div>
        <div class="timeline-area">${item.area}</div>
        <div class="timeline-user">Usuario: ${item.user}</div>
        <div class="timeline-content">${item.content}</div>
      `;
      timeline.appendChild(timelineItem);
    });
  } else {
    // Mostrar mensaje si no hay datos
    const noDataItem = document.createElement('div');
    noDataItem.className = 'timeline-item';
    noDataItem.innerHTML = `
      <div class="timeline-content" style="text-align: center; color: var(--gray-500);">
        No hay historial disponible para esta orden
      </div>
    `;
    timeline.appendChild(noDataItem);
  }
}

// Función para cargar las acciones según el estado de la orden derivada
function loadDerivedOrderActions(orderId, status) {
  const actionsContainer = document.getElementById('derivedOrderActions');
  const statusElement = document.getElementById('derivedOrderStatus');
  actionsContainer.innerHTML = '';

  if (status === 'Pendiente') {
    statusElement.textContent = 'Pendiente de respuesta comercial';
    statusElement.className = 'contact-status pending';

    actionsContainer.innerHTML = `
      <div class="contact-action-btn cancel" onclick="showCancelDerivedModal('${orderId}')">
        <i class="fas fa-times-circle"></i>
        <div class="contact-action-content">
          <div class="contact-action-title">Anular Orden</div>
          <div class="contact-action-desc">Enviar a bandeja de Cancelados</div>
        </div>
      </div>
    `;
  } else if (status === 'Con Respuesta') {
    statusElement.textContent = 'Con respuesta comercial';
    statusElement.className = 'contact-status completed';

    actionsContainer.innerHTML = `
      <div class="contact-action-btn backlog" onclick="showResumeOrderModal('${orderId}')">
        <i class="fas fa-undo"></i>
        <div class="contact-action-content">
          <div class="contact-action-title">Retomar Orden</div>
          <div class="contact-action-desc">Enviar a bandeja de Backlog</div>
        </div>
      </div>
      
      <div class="contact-action-btn derive" onclick="showRederiveModal('${orderId}')">
        <i class="fas fa-share-alt"></i>
        <div class="contact-action-content">
          <div class="contact-action-title">Derivar Nuevamente</div>
          <div class="contact-action-desc">Enviar nuevamente a Comercial</div>
        </div>
      </div>
      
      <div class="contact-action-btn cancel" onclick="showCancelDerivedModal('${orderId}')">
        <i class="fas fa-times-circle"></i>
        <div class="contact-action-content">
          <div class="contact-action-title">Anular Orden</div>
          <div class="contact-action-desc">Enviar a bandeja de Cancelados</div>
        </div>
      </div>
    `;
  }
}

// Función para cambiar pestaña en detalle de órdenes derivadas
function switchDerivedTab(tabName) {
  // Ocultar todas las pestañas
  const tabs = document.querySelectorAll('#derivedOrderDetailModal .detail-tab');
  tabs.forEach(tab => tab.classList.remove('active'));

  const contents = document.querySelectorAll('#derivedOrderDetailModal .detail-content');
  contents.forEach(content => content.classList.remove('active'));

  // Mostrar la pestaña seleccionada
  let tabIndex = 0;
  if (tabName === 'general') tabIndex = 0;
  else if (tabName === 'derivation') tabIndex = 1;
  else if (tabName === 'response') tabIndex = 2;
  else if (tabName === 'history') tabIndex = 3;

  document.querySelectorAll('#derivedOrderDetailModal .detail-tab')[tabIndex].classList.add('active');
  document.getElementById(`derived-${tabName}-tab`).classList.add('active');
}

// Función para mostrar modal de anular orden derivada
function showCancelDerivedModal(orderId) {
  currentOrderId = orderId;
  const order = derivedOrdersData[orderId];

  if (order) {
    document.getElementById('cancelDerivedOrderId').textContent = orderId;
    document.getElementById('cancelDerivedCustomer').textContent = order.customer;
    document.getElementById('cancelDerivedAddress').textContent = order.address;
    document.getElementById('cancelDerivedServiceType').textContent = order.serviceType;

    document.getElementById('cancelDerivedModal').style.display = 'flex';
  }
}

// Función para confirmar anulación de orden derivada
function cancelDerivedOrderConfirm() {
  const orderId = document.getElementById('cancelDerivedOrderId').textContent;
  const reason = document.getElementById('cancelDerivedReason').value;
  const comments = document.getElementById('cancelDerivedComments').value;

  if (!reason || !comments) {
    alert('Por favor complete todos los campos');
    return;
  }

  // Crear mensaje de anulación
  const cancelMessage = `Orden anulada: ${reason} - ${comments}`;

  // Agregar evento a la trazabilidad
  addTimelineEvent(orderId, 'Atención al Cliente', 'María González', cancelMessage);

  alert(`Orden ${orderId} anulada correctamente y enviada a la bandeja de Cancelados.`);

  // Eliminar la orden de la tabla
  const rows = document.querySelectorAll('#derivadosTableBody .order-row');
  rows.forEach(row => {
    if (row.querySelector('.order-id').textContent === orderId) {
      row.remove();
    }
  });

  closeModal('cancelDerivedModal');
  closeModal('derivedOrderDetailModal');

  // Resetear formulario
  document.getElementById('cancelDerivedForm').reset();

  // Actualizar alertas
  checkDerivedOrdersAlerts();
}

// Función para mostrar modal de derivar nuevamente
function showRederiveModal(orderId) {
  currentOrderId = orderId;
  const order = derivedOrdersData[orderId];

  if (order) {
    document.getElementById('rederiveOrderId').textContent = orderId;
    document.getElementById('rederiveCustomer').textContent = order.customer;
    document.getElementById('rederiveAddress').textContent = order.address;
    document.getElementById('rederiveServiceType').textContent = order.serviceType;

    document.getElementById('rederiveModal').style.display = 'flex';
  }
}

// Función para confirmar nueva derivación
function rederiveOrderConfirm() {
  const orderId = document.getElementById('rederiveOrderId').textContent;
  const reason = document.getElementById('rederiveReason').value;
  const comments = document.getElementById('rederiveComments').value;

  if (!reason || !comments) {
    alert('Por favor complete todos los campos');
    return;
  }

  // Crear mensaje de nueva derivación
  const rederiveMessage = `Nueva derivación a Comercial: ${reason} - ${comments}`;

  // Actualizar datos de la orden
  const order = derivedOrdersData[orderId];
  if (order) {
    order.status = 'Pendiente';
    order.responseDate = null;
    order.responseUser = null;
    order.responseResult = null;
    order.responseComments = null;
    order.additionalInfo = null;

    // Actualizar la tabla
    const rows = document.querySelectorAll('#derivadosTableBody .order-row');
    rows.forEach(row => {
      if (row.querySelector('.order-id').textContent === orderId) {
        // Actualizar estado
        const statusCell = row.querySelector('.status-badge');
        statusCell.textContent = 'Pendiente';
        statusCell.className = 'status-badge status-pending';

        // Actualizar atributo
        row.setAttribute('data-status', 'pending');
      }
    });
  }

  // Agregar evento a la trazabilidad
  addTimelineEvent(orderId, 'Atención al Cliente', 'María González', rederiveMessage);

  alert(`Orden ${orderId} derivada nuevamente al área de Comercial.`);

  closeModal('rederiveModal');
  closeModal('derivedOrderDetailModal');

  // Resetear formulario
  document.getElementById('rederiveForm').reset();

  // Actualizar alertas
  checkDerivedOrdersAlerts();
}

// Función para mostrar modal de retomar orden
function showResumeOrderModal(orderId) {
  currentOrderId = orderId;
  const order = derivedOrdersData[orderId];

  if (order) {
    document.getElementById('resumeOrderId').textContent = orderId;
    document.getElementById('resumeCustomer').textContent = order.customer;
    document.getElementById('resumeAddress').textContent = order.address;
    document.getElementById('resumeServiceType').textContent = order.serviceType;

    // Mostrar información comercial recibida
    const commercialInfo = document.getElementById('resumeCommercialInfo');
    commercialInfo.innerHTML = `
      <div><strong>Resultado:</strong> ${order.responseResult}</div>
      <div><strong>Comentarios:</strong> ${order.responseComments}</div>
      ${order.additionalInfo ? `<div><strong>Información Adicional:</strong> ${order.additionalInfo}</div>` : ''}
    `;

    document.getElementById('resumeOrderModal').style.display = 'flex';
  }
}

// Función para confirmar retomar orden
function resumeOrderConfirm() {
  const orderId = document.getElementById('resumeOrderId').textContent;
  const comments = document.getElementById('resumeComments').value;

  // Crear mensaje de retomada
  let resumeMessage = 'Orden retomada y enviada a Backlog';
  if (comments) {
    resumeMessage += ` - ${comments}`;
  }

  // Agregar evento a la trazabilidad
  addTimelineEvent(orderId, 'Atención al Cliente', 'María González', resumeMessage);

  alert(`Orden ${orderId} retomada correctamente y enviada a la bandeja de Backlog.`);

  // Eliminar la orden de la tabla
  const rows = document.querySelectorAll('#derivadosTableBody .order-row');
  rows.forEach(row => {
    if (row.querySelector('.order-id').textContent === orderId) {
      row.remove();
    }
  });

  closeModal('resumeOrderModal');
  closeModal('derivedOrderDetailModal');

  // Resetear formulario
  document.getElementById('resumeOrderForm').reset();

  // Actualizar alertas
  checkDerivedOrdersAlerts();
}

// Función para ver órdenes pendientes de respuesta
document.getElementById('viewPendingResponseBtn').addEventListener('click', function() {
  // Activar el botón de filtro pendientes
  const filterButtons = document.querySelectorAll('#derivados-page .filter-btn');
  filterButtons.forEach(btn => btn.classList.remove('active'));
  document.querySelector('.filter-btn[onclick="filterOrders(\'pending\', \'derivados\')"]').classList.add('active');

  // Filtrar las órdenes pendientes
  const rows = document.querySelectorAll('#derivadosTableBody .order-row');
  rows.forEach(row => {
    const status = row.getAttribute('data-status');
    if (status === 'pending') {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });

  // Scroll hasta la tabla
  document.querySelector('#derivados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver órdenes con nueva respuesta
document.getElementById('viewNewResponseBtn').addEventListener('click', function() {
  // Activar el botón de filtro con respuesta
  const filterButtons = document.querySelectorAll('#derivados-page .filter-btn');
  filterButtons.forEach(btn => btn.classList.remove('active'));
  document.querySelector('.filter-btn[onclick="filterOrders(\'responded\', \'derivados\')"]').classList.add('active');

  // Filtrar las órdenes con respuesta
  const rows = document.querySelectorAll('#derivadosTableBody .order-row');
  rows.forEach(row => {
    const status = row.getAttribute('data-status');
    if (status === 'responded') {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });

  // Scroll hasta la tabla
  document.querySelector('#derivados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para ver detalles de órdenes canceladas
function viewCancelledOrderDetail(orderId) {
  currentOrderId = orderId;
  const order = cancelledOrdersData[orderId];

  if (order) {
    // Datos generales
    document.getElementById('cancelledDetailOrderId').textContent = orderId;
    document.getElementById('cancelledDetailCustomer').textContent = order.customer;
    document.getElementById('cancelledDetailAddress').textContent = order.address;
    document.getElementById('cancelledDetailPhone').textContent = order.phone;
    document.getElementById('cancelledDetailServiceType').textContent = order.serviceType;
    document.getElementById('cancelledDetailOFSCDate').textContent = order.ofscDate;
    document.getElementById('cancelledDetailPriority').textContent = order.priority;
    document.getElementById('cancelledDetailStatus').textContent = order.status;

    // Datos de cancelación
    document.getElementById('cancelledDetailCancellationDate').textContent = order.cancellationDate;
    document.getElementById('cancelledDetailCancelledBy').textContent = order.cancelledBy;
    document.getElementById('cancelledDetailCancellationReason').textContent = order.cancellationReason;
    document.getElementById('cancelledDetailCancellationComments').textContent = order.cancellationComments;

    // Cargar trazabilidad
    loadCancelledOrderTimeline(orderId);

    document.getElementById('cancelledOrderDetailModal').style.display = 'flex';
  }
}

// Función para cargar la trazabilidad de la orden cancelada
function loadCancelledOrderTimeline(orderId) {
  const timeline = document.getElementById('cancelledOrderTimeline');
  timeline.innerHTML = '';

  // Usar los datos específicos para órdenes canceladas
  const timelineData = cancelledOrderTimelineData[orderId] || [];
  
  if (timelineData.length > 0) {
    timelineData.forEach(item => {
      const timelineItem = document.createElement('div');
      timelineItem.className = 'timeline-item';
      timelineItem.innerHTML = `
        <div class="timeline-date">${item.date}</div>
        <div class="timeline-area">${item.area}</div>
        <div class="timeline-user">Usuario: ${item.user}</div>
        <div class="timeline-content">${item.content}</div>
      `;
      timeline.appendChild(timelineItem);
    });
  } else {
    // Mostrar mensaje si no hay datos
    const noDataItem = document.createElement('div');
    noDataItem.className = 'timeline-item';
    noDataItem.innerHTML = `
      <div class="timeline-content" style="text-align: center; color: var(--gray-500);">
        No hay historial disponible para esta orden
      </div>
    `;
    timeline.appendChild(noDataItem);
  }
}

// Función para cambiar pestaña en detalle de órdenes canceladas
function switchCancelledTab(tabName) {
  // Ocultar todas las pestañas
  const tabs = document.querySelectorAll('#cancelledOrderDetailModal .detail-tab');
  tabs.forEach(tab => tab.classList.remove('active'));

  const contents = document.querySelectorAll('#cancelledOrderDetailModal .detail-content');
  contents.forEach(content => content.classList.remove('active'));

  // Mostrar la pestaña seleccionada
  let tabIndex = 0;
  if (tabName === 'general') tabIndex = 0;
  else if (tabName === 'cancellation') tabIndex = 1;
  else if (tabName === 'history') tabIndex = 2;

  document.querySelectorAll('#cancelledOrderDetailModal .detail-tab')[tabIndex].classList.add('active');
  document.getElementById(`cancelled-${tabName}-tab`).classList.add('active');
}

// Función para verificar alertas en la bandeja de cancelados
function checkCancelledOrdersAlerts() {
  let recentCancelledCount = 0;
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);

  // Contar órdenes canceladas recientemente (últimas 24 horas)
  document.querySelectorAll('#canceladosTableBody .order-row').forEach(row => {
    const cancellationDate = new Date(row.getAttribute('data-cancellation-date'));
    
    if (cancellationDate >= yesterday) {
      recentCancelledCount++;
    }
  });

  // Mostrar alerta si hay casos
  if (recentCancelledCount > 0) {
    document.getElementById('recentCancelledAlert').style.display = 'flex';
    document.getElementById('recentCancelledCount').textContent = recentCancelledCount;
  } else {
    document.getElementById('recentCancelledAlert').style.display = 'none';
  }
}

// Función para ver órdenes canceladas recientemente
document.getElementById('viewRecentCancelledBtn').addEventListener('click', function() {
  // Activar el botón de filtro última semana
  const filterButtons = document.querySelectorAll('#cancelados-page .filter-btn');
  filterButtons.forEach(btn => btn.classList.remove('active'));
  document.querySelector('.filter-btn[onclick="filterOrders(\'last-week\', \'cancelados\')"]').classList.add('active');

  // Filtrar las órdenes de la última semana
  const rows = document.querySelectorAll('#canceladosTableBody .order-row');
  rows.forEach(row => {
    const cancellationDate = new Date(row.getAttribute('data-cancellation-date'));
    const today = new Date();
    const oneWeekAgo = new Date(today);
    oneWeekAgo.setDate(today.getDate() - 7);

    if (cancellationDate >= oneWeekAgo) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });

  // Scroll hasta la tabla
  document.querySelector('#cancelados-page .main-content').scrollIntoView({ behavior: 'smooth' });
});

// Función para manejar la navegación del menú lateral
document.querySelectorAll('.menu-item').forEach(item => {
item.addEventListener('click', function(e) {
e.preventDefault();

// Obtener la página a mostrar
const page = this.getAttribute('data-page');

// Cambiar a la página seleccionada
changePage(page);
});
});

// Cerrar modales al hacer clic fuera
window.onclick = function(event) {
const modals = document.querySelectorAll('.modal');
modals.forEach(modal => {
if (event.target === modal) {
modal.style.display = 'none';
}
});
}

// Función para alternar la visibilidad de los módulos del menú
function toggleModule(moduleId) {
  const moduleContent = document.getElementById(moduleId);
  const moduleArrow = moduleContent.previousElementSibling.querySelector('.module-arrow');
  
  // Alternar la clase 'expanded' para mostrar/ocultar el contenido
  moduleContent.classList.toggle('expanded');
  
  // Rotar la flecha
  moduleArrow.classList.toggle('rotated');
  
  // Cerrar otros módulos si se desea (opcional)
  // Si quieres que solo un módulo esté abierto a la vez, descomenta el siguiente bloque:
  /*
  const allModules = document.querySelectorAll('.module-content');
  const allArrows = document.querySelectorAll('.module-arrow');
  
  allModules.forEach(module => {
    if (module.id !== moduleId && module.classList.contains('expanded')) {
      module.classList.remove('expanded');
      const arrow = module.previousElementSibling.querySelector('.module-arrow');
      arrow.classList.remove('rotated');
    }
  });
  */
}

// Función para manejar la navegación del menú lateral
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    
    // Obtener la página a mostrar
    const page = this.getAttribute('data-page');
    
    // Cambiar a la página seleccionada
    changePage(page);
    
    // Marcar el elemento del menú como activo
    document.querySelectorAll('.menu-item').forEach(menuItem => {
      menuItem.classList.remove('active');
    });
    this.classList.add('active');
  });
});

// Inicializar la página
document.addEventListener('DOMContentLoaded', function() {
    // Actualizar la hora inmediatamente al cargar la página
    updateCurrentTime();
    
    // Actualizar la hora cada segundo
    setInterval(updateCurrentTime, 1000);
    
    // Mostrar la página TCP por defecto
    changePage('tcp');
    
    // Expandir el primer módulo por defecto (opcional)
    const firstModule = document.querySelector('.module-content');
    const firstArrow = document.querySelector('.module-arrow');
    if (firstModule && firstArrow) {
        firstModule.classList.add('expanded');
        firstArrow.classList.add('rotated');
    }
});

// Inicializar la página
document.addEventListener('DOMContentLoaded', function() {
// Mostrar la página finalizado por defecto
changePage('tcp');
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>